<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³Œå°¿ç³»çµ±è‡ªå‹•è¨ºæ–·æ©Ÿ</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Tone.js CDN for Sound Effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* === æ¨¡æ“¬åœ°é¢èˆ‡æ©Ÿå™¨ä¸»é«”æ¨£å¼ (ä¿æŒä¸€è‡´) === */
        body {
            font-family: 'Inter', sans-serif;
            /* æ¨¡æ“¬æ°´æ³¥åœ°é¢æˆ–å·¥æ¥­åœ°æ¿çš„æ·±ç°è‰²èƒŒæ™¯ */
            background-color: #3f4a56; 
            background-image: linear-gradient(145deg, #3f4a56 0%, #2f3840 100%);
            display: flex;
            flex-direction: column; 
            justify-content: flex-start; 
            align-items: center; 
            min-height: 100vh;
            padding: 2rem 0;
            overflow-y: auto;
        }
        .vending-machine {
            max-width: 400px;
            width: 95%;
            margin: 0 auto; 
            border-radius: 1.5rem 1.5rem 0 0; 
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.8), 0 0 0 8px #5c6773; 
            background-image: linear-gradient(to bottom, #4b5563, #1f2937); /* æ·±ç°è‰²é‡‘å±¬æ¼¸è®Š */
            border: 4px solid #7c8896;
            border-bottom: none; 
        }

        /* === æ©Ÿå™¨è…³éƒ¨æ¨£å¼ (æ›´æ–°ç‚ºå‚¾æ–œå·¥æ¥­è…³) === */
        .machine-base {
            max-width: 400px;
            width: 95%;
            margin: 0 auto 2rem auto; 
            padding: 0 1.5rem; /* å¢åŠ å·¦å³é‚Šè·ä¾†å®šä½è…³ */
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            position: relative;
            background-color: #2f3840; /* æ©Ÿèº«å’Œè…³éƒ¨çš„é€£æ¥è‰² */
            border: 4px solid #7c8896;
            border-top: none; 
            border-radius: 0 0 1.5rem 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            padding-bottom: 0.5rem; /* åº•éƒ¨å…§é‚Šè· */
        }

        /* æ–°å¢ï¼šè…³éƒ¨æ”¯æ’çµæ§‹çš„è¦–è¦ºæ•ˆæœ */
        .machine-foot-angled-container {
            display: flex;
            justify-content: space-between;
            width: 100%;
            height: 3.5rem; /* ç¢ºä¿å®¹å™¨é«˜åº¦ */
        }
        
        .machine-foot-angled {
            width: 35%; 
            height: 100%;
            background-color: #5c6773; 
            border: 3px solid #7c8896;
            border-top: none;
            /* é—œéµï¼šä½¿ç”¨ skewX è®Šå½¢ä¾†å‰µå»ºå‚¾æ–œçš„æ”¯æ’æ„Ÿ */
            transform: skewX(-5deg); 
            transform-origin: bottom center;
            box-shadow: inset 0 -5px 10px rgba(0, 0, 0, 0.5), 5px 5px 10px rgba(0, 0, 0, 0.5);
            background-image: linear-gradient(180deg, #4b5563 0%, #5c6773 100%);
            border-radius: 0.25rem;
        }

        /* è®“å³è…³å‚¾æ–œæ–¹å‘ç›¸å */
        .machine-foot-angled:last-child {
            transform: skewX(5deg);
        }
        
        /* === æŠ•å¹£å£å°ˆå±¬æ¨£å¼ (ä¿æŒä¸€è‡´) === */
        .coin-slot-container {
            background-image: linear-gradient(to bottom, #a0aec0, #718096); 
            padding: 0.5rem;
            border-radius: 9999px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.6), 0 4px 6px rgba(0, 0, 0, 0.3); 
            transition: transform 0.1s ease;
        }
        .coin-slot-opening {
            width: 100%;
            height: 100%;
            border-radius: 9999px;
            background-color: #374151;
            box-shadow: inset 0 0 15px rgba(0, 0, 0, 1), 0 1px 0 rgba(255, 255, 255, 0.2); 
            cursor: pointer;
        }
        .coin-slot-container:active {
            transform: scale(0.95);
        }
        
        /* === ä¿æŒåŸæœ‰æ³Œå°¿ç§‘ä»‹é¢æ¨£å¼ (ä¿æŒä¸€è‡´) === */
        .vending-display {
            border: 5px solid #00c7e5; 
            box-shadow: inset 0 0 10px #00c7e5, 0 0 15px #00c7e5; 
        }
        .item-button {
            transition: transform 0.1s, box-shadow 0.1s;
            background-image: linear-gradient(135deg, #2a3c5a 0%, #1f2d42 100%);
            word-break: normal; 
            overflow-wrap: break-word; 
            hyphens: manual; 
        }
        .item-button:hover:not(:disabled) { 
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        .item-button:active:not(:disabled) {
            transform: translateY(0);
        }
        .item-button:disabled {
            opacity: 0.4; 
            cursor: not-allowed;
        }
        .selected {
            border: 3px solid #facc15; 
            box-shadow: 0 0 10px #facc15;
            background-image: linear-gradient(135deg, #facc15 0%, #eab308 100%);
            color: #1f2d42; 
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: manual;
        }
        .result-card-slot {
            background-color: #1f2d42;
            padding: 1rem; 
            border-radius: 0 0 0.75rem 0.75rem; 
            position: relative;
            min-height: 6rem; 
            overflow: hidden; 
        }
        .red-divider {
            height: 8px; 
            background-color: #ff0000; 
            width: 100%;
            box-shadow: 0 0 5px #ff0000, 0 0 15px rgba(255, 0, 0, 0.8); 
            transition: box-shadow 0.3s;
        }
        @keyframes printOut {
            0% {
                transform: translateY(-100%); 
                opacity: 0.2;
            }
            100% {
                transform: translateY(0); 
                opacity: 1;
            }
        }
        .print-animation {
            animation: printOut 1.5s ease-out forwards;
            position: relative; 
        }
        @keyframes neon-flash-red {
            0%, 100% {
                box-shadow: 0 0 5px #ff0000, 0 0 15px rgba(255, 0, 0, 0.8);
            }
            50% {
                box-shadow: 0 0 2px #ff0000, 0 0 8px rgba(255, 0, 0, 0.4);
            }
        }
        .flashing-neon-divider {
            animation: neon-flash-red 0.5s infinite alternate;
        }
    </style>
</head>
<body class="p-4 flex flex-col items-center justify-center min-h-screen">

    <div id="vendingMachine" class="vending-machine w-full max-w-lg rounded-xl overflow-hidden p-4 sm:p-6 text-white border-8 border-gray-900">
        
        <!-- é ‚éƒ¨æ¨™é¡Œå’Œèªªæ˜ -->
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-6 tracking-wider text-[#00c7e5]">
            <span class="block">æ³Œå°¿ç³»çµ±è¨ºæ–·æ©Ÿ</span> 
            <!-- START: è»Ÿé«”ç‰ˆæœ¬ç·¨è™Ÿ -->
            <span class="text-base font-normal text-gray-400 block mt-1 text-center">URO Kiosk Unit-v1ï¼ˆ2025.9.28 e43581y26y)</span>
            <!-- END: è»Ÿé«”ç‰ˆæœ¬ç·¨è™Ÿ -->
        </h1>
        
        <!-- é¡¯ç¤ºè¢å¹• -->
        <div id="display" class="vending-display p-4 h-28 sm:h-36 mb-6 rounded-lg text-xl sm:text-2xl font-mono text-[#00c7e5] flex flex-col justify-center items-center text-center bg-[#101c30]">
            <p id="instructionText" class="animate-pulse">è«‹æŠ•å¹£å•Ÿå‹•æœå‹™...</p>
            <p id="selectionText" class="text-base text-gray-400 mt-1"></p>
        </div>

        <!-- === æŠ•å¹£å€ === -->
        <div class="mb-6 p-4 rounded-xl bg-gray-800 border-2 border-gray-700 shadow-inner flex justify-center items-center space-x-6">
            <div class="flex-shrink-0 text-center">
                <p class="text-sm font-semibold text-gray-300 mb-1">æŠ•å¹£å£ (é»æ“Šå•Ÿå‹•)</p>
                <div id="coinSlot" class="coin-slot-container w-20 h-16 cursor-pointer" title="é»æ“Šæ¨¡æ“¬æŠ•å…¥ç¡¬å¹£">
                    <div class="coin-slot-opening"></div>
                </div>
            </div>
            <!-- START: æ›´æ–°æœå‹™æ€§è³ªæè¿° -->
            <div id="coinMessage" class="text-sm text-[#00c7e5] font-bold text-center">
                æœ¬è¨ºæ–·æ©Ÿç‚ºæœå‹™æ€§è³ªã€‚
            </div>
            <!-- END: æ›´æ–°æœå‹™æ€§è³ªæè¿° -->
        </div>
        <!-- === æŠ•å¹£å€çµæŸ === -->

        <!-- ç‰©å“/é¸é …é¸æ“‡å€åŸŸ (æ€§åˆ¥/ç—‡ç‹€é¸æ“‡) -->
        <div id="optionsGrid" class="grid grid-cols-2 gap-4 mb-6">
            <!-- é¸é …å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
        </div>
        
        <!-- çµæœ/æ§åˆ¶é¢æ¿ -->
        <div class="p-4 rounded-lg bg-[#101c30] border border-gray-700">
            <h2 class="text-xl font-bold text-center mb-3 text-gray-300">æ§åˆ¶é¢æ¿</h2>
            <div class="flex justify-around space-x-4">
                <button id="confirmButton" class="w-full p-3 font-bold rounded-xl text-lg bg-yellow-500 hover:bg-yellow-600 text-gray-900 transition duration-150 disabled:opacity-50" disabled>
                    ç¢ºèªé¸æ“‡ (âœ“)
                </button>
                <button id="backButton" class="w-full p-3 font-bold rounded-xl text-lg bg-blue-600 hover:bg-blue-700 transition duration-150 hidden" disabled>
                    è¿”å›ä¸Šå±¤ (â†)
                </button>
                <button id="resetButton" class="w-full p-3 font-bold rounded-xl text-lg bg-red-600 hover:bg-red-700 transition duration-150">
                    é‡æ–°é–‹å§‹ (âŸ²)
                </button>
            </div>
        </div>

        <!-- è¨ºæ–·å¡å‡ºå£æ§½ -->
        <div class="mt-4">
            <!-- ç´…ç²—ç·šï¼šç”¨æ–¼åˆ†éš”æ§åˆ¶é¢æ¿å’Œå‡ºå£æ§½ï¼Œä¸¦é€²è¡Œéœ“è™¹é–ƒçˆ -->
            <div id="redDivider" class="red-divider"></div>

            <!-- å‡ºå£æ§½å®¹å™¨ -->
            <div id="resultCardSlot" class="result-card-slot">
                <p class="text-sm text-gray-500 mb-2">å¥åº·å»ºè­°å¡å‡ºå£ (è«‹åœ¨æ­¤é ˜å–):</p>
                <!-- ç¢ºä¿åˆå§‹ç‹€æ…‹æ˜¯ hidden -->
                <div id="resultCard" class="hidden bg-gray-100 p-4 rounded-lg text-gray-900 shadow-xl"> 
                    <h3 class="text-xl font-bold text-blue-600 mb-2">è¨ºæ–·å¡å·²ç™¼æ”¾</h3>
                    <p id="cardTitle" class="font-semibold text-lg"></p>
                    <!-- ç¢ºä¿ä½¿ç”¨ DIV å®¹å™¨ä»¥å®¹ç´è¤‡é›œçš„ HTML å…§å®¹ -->
                    <div id="cardContent" class="text-sm mt-2"></div> 
                    <p class="text-xs text-red-600 mt-3 font-bold">â€» ç·Šæ€¥å…è²¬è²æ˜ï¼šæœ¬å¡ä¸å…·é†«ç™‚è¨ºæ–·æ•ˆåŠ›ï¼Œè«‹å‹™å¿…è«®è©¢æ³Œå°¿ç§‘é†«å¸«ã€‚</p>
                </div>
            </div>
        </div>

    </div> <!-- End of .vending-machine -->

    <!-- æ©Ÿå™¨åº•éƒ¨èˆ‡è…³éƒ¨ (æ›´æ–°) -->
    <div class="machine-base w-full max-w-lg mx-auto">
        <div class="machine-foot-angled-container">
            <div class="machine-foot-angled ml-4"></div>
            <div class="machine-foot-angled mr-4"></div>
        </div>
    </div>
    <!-- æ©Ÿå™¨åº•éƒ¨èˆ‡è…³éƒ¨çµæŸ -->

    <script>
        // è¨­å®šå…¨åŸŸè®Šæ•¸
        const instructionText = document.getElementById('instructionText');
        const selectionText = document.getElementById('selectionText');
        const optionsGrid = document.getElementById('optionsGrid');
        const confirmButton = document.getElementById('confirmButton');
        const backButton = document.getElementById('backButton');
        const resetButton = document.getElementById('resetButton');
        const redDivider = document.getElementById('redDivider'); 
        const resultCard = document.getElementById('resultCard');
        const cardTitle = document.getElementById('cardTitle');
        const cardContent = document.getElementById('cardContent');
        const coinSlot = document.getElementById('coinSlot');
        const coinMessage = document.getElementById('coinMessage');

        // æ ¸å¿ƒç‹€æ…‹è®Šæ•¸
        let gameState = 'GENDER'; 
        let isServiceActive = false; // æ–°å¢ï¼šæ§åˆ¶æœå‹™æ˜¯å¦å•Ÿå‹•
        let selectedGender = null;
        let selectedCategory = null; 
        let selectedSymptom = null;
        let selectedSubsymptoms = [];
        let neonTimeout = null; 
        
        // Tone.js Synth åˆå§‹åŒ–
        let synth = null; 
        let coinSoundSynth = null; 

        // --- éŸ³æ•ˆç”Ÿæˆé‚è¼¯ ---
        function playPrintSound() {
            if (Tone.context.state !== 'running') {
                Tone.start().then(() => {_generatePrintSound();}).catch(err => {console.error("Failed to start Tone.js AudioContext:", err);});
            } else {_generatePrintSound();}
        }

        function _generatePrintSound() {
            if (!synth) {
                synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: { type: "square" }, 
                    envelope: { attack: 0.01, decay: 0.1, sustain: 0.0, release: 0.3 }
                }).toDestination();
            }
            const volume = 0.5;
            const now = Tone.now();
            const duration = "8n";
            synth.triggerAttackRelease("C4", duration, now, volume); 
            synth.triggerAttackRelease("D4", duration, now + 0.2, volume); 
        }

        function playCoinSound() {
            if (Tone.context.state !== 'running') {
                Tone.start().then(() => {_generateCoinSound();}).catch(err => {console.error("Failed to start Tone.js AudioContext for coin sound:", err);});
            } else {_generateCoinSound();}
        }

        function _generateCoinSound() {
            if (!coinSoundSynth) {
                coinSoundSynth = new Tone.NoiseSynth({
                    noise: { type: "white" },
                    envelope: { attack: 0.001, decay: 0.1, sustain: 0.0, release: 0.15 }
                }).toDestination();
            }
            const now = Tone.now();
            coinSoundSynth.triggerAttackRelease("16n", now);
        }
        
        // --- æŠ•å¹£å£äº‹ä»¶ï¼šæ¨¡æ“¬æŠ•å…¥ç¡¬å¹£/å•Ÿå‹•æœå‹™ ---
        coinSlot.addEventListener('click', () => {
            if (isServiceActive) {
                 coinMessage.textContent = "æœå‹™å·²å•Ÿå‹•ï¼Œè«‹é¸æ“‡æ€§åˆ¥ï¼";
                 return;
            }

            playCoinSound();
            isServiceActive = true; 
            
            // å•Ÿç”¨æ€§åˆ¥é¸æ“‡æŒ‰éˆ•
            document.querySelectorAll('.gender-button').forEach(btn => btn.disabled = false);
            backButton.disabled = false;
            
            // é¡¯ç¤ºå•Ÿå‹•ç¢ºèªè¨Šæ¯
            coinMessage.textContent = "ç¡¬å¹£æŠ•å…¥æˆåŠŸï¼æœå‹™å·²æº–å‚™å°±ç·’ã€‚";
            updateDisplay('æ³Œé†«é—œå¿ƒæ‚¨ã€‚æ­¡è¿ä½¿ç”¨ï¼Œè«‹é¸æ“‡æ‚¨çš„æ€§åˆ¥...');
            
            setTimeout(() => {
                // å°‡è¨Šæ¯æ”¹å›æœå‹™æ€§è³ª
                coinMessage.textContent = "æœ¬è¨ºæ–·æ©Ÿç‚ºæœå‹™æ€§è³ªã€‚";
            }, 2000);
        });


        // æ¨¡æ“¬æ•¸æ“šåº« (ä¿æŒä¸è®Š)
        const data = {
            'æ’å°¿ç•°å¸¸ï¼ˆUrinary Dysfunctionï¼‰': {
                icon: 'ğŸ’§',
                symptoms: {
                    'é »å°¿/å¤œå°¿ï¼ˆFrequency/Nocturiaï¼‰': {
                        description: 'å¸¸è¦‹æ–¼æ”è­·è…ºè‚¥å¤§ã€è†€èƒ±éå‹•ç—‡ã€ç¥ç¶“æ€§è†€èƒ±ç­‰ã€‚å»ºè­°æ¸›å°‘åˆºæ¿€æ€§é£²æ–™åŠç¡å‰é£²æ°´ï¼Œä¸¦é€²è¡Œæ’å°¿è¨“ç·´ã€‚',
                        subsymptoms: {
                            'æ—¥é–“é »å°¿ï¼ˆDaytime Frequencyï¼‰': 'å¯èƒ½èˆ‡å’–å•¡å› æˆ–æ¶²é«”æ”å–éå¤šç›¸é—œã€‚å»ºè­°ç›£æ¸¬æ¯æ—¥é£²æ°´é‡ã€‚',
                            'å¤œé–“å¤šå°¿ï¼ˆNocturiaï¼‰': 'å¯èƒ½èˆ‡å¿ƒè‡Ÿæˆ–è…è‡Ÿå•é¡Œç›¸é—œã€‚è‹¥è¶…é2æ¬¡/å¤œï¼Œéœ€æª¢æŸ¥è¡€ç³–åŠå¿ƒåŠŸèƒ½ã€‚',
                            'ä¼´éš¨æ€¥å°¿ï¼ˆWith Urgencyï¼‰': 'æš—ç¤ºè†€èƒ±éå‹•ç—‡ã€‚è€ƒæ…®æŠ—è†½é¹¼è—¥ç‰©æ²»ç™‚ã€‚'
                        }
                    },
                    'æ’å°¿ç–¼ç—›ï¼ˆDysuriaï¼‰': {
                        description: 'æ’å°¿æ™‚ä¼´éš¨ç¼ç†±ã€åˆºç—›æˆ–ä¸é©æ„Ÿã€‚æœ€å¸¸è¦‹æ–¼æ³Œå°¿é“æ„ŸæŸ“ï¼ˆUTIï¼‰æˆ–è†€èƒ±ç‚ï¼Œä½†çµçŸ³æˆ–æ”è­·è…ºç‚äº¦å¯èƒ½å¼•èµ·ã€‚éœ€é€²è¡Œå°¿æ¶²å¸¸è¦æª¢æŸ¥ã€‚',
                        subsymptoms: {
                            'ç¼ç†±æ„Ÿï¼ˆBurning Sensationï¼‰': 'é«˜åº¦æç¤ºå°¿é“æˆ–è†€èƒ±åˆºæ¿€ï¼Œå¸¸è¦‹æ–¼è†€èƒ±ç‚ã€‚',
                            'åˆºç—›æ„Ÿï¼ˆStabbing Painï¼‰': 'å¯èƒ½èˆ‡çµçŸ³æˆ–å°¿é“ç‚ç—‡ç›¸é—œã€‚',
                            'æ’å°¿å¾Œç–¼ç—›ï¼ˆPain after Voidingï¼‰': 'å¤šèˆ‡è†€èƒ±ç—™æ”£ç›¸é—œï¼Œè¦‹æ–¼é–“è³ªæ€§è†€èƒ±ç‚ã€‚',
                            'å°¿é“å£ç–¼ç—›ï¼ˆMeatal Painï¼‰': 'æç¤ºå°¿é“ç‚æˆ–é¾œé ­ç‚ã€‚'
                        }
                    },
                    'å°¿æ€¥/æ€¥è¿«æ€§å°¿å¤±ç¦ï¼ˆUrgency/Urge Incontinenceï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è†€èƒ±éå‹•ç—‡ã€ç¥ç¶“æ€§è†€èƒ±ç­‰ã€‚å»ºè­°é€²è¡Œéª¨ç›†åº•è‚Œè¨“ç·´ï¼ˆå‡±æ ¼çˆ¾é‹å‹•ï¼‰ã€‚',
                        subsymptoms: {
                            'çªç„¶å¼·çƒˆå°¿æ„ï¼ˆSudden Urgeï¼‰': 'å¯èƒ½èˆ‡æ„ŸæŸ“æˆ–ç¥ç¶“å•é¡Œç›¸é—œã€‚éœ€å°¿åŸ¹é¤Šæª¢æŸ¥ã€‚',
                            'æ¼å°¿ç™¼ç”Ÿï¼ˆLeakageï¼‰': 'å€åˆ†æ€¥è¿«æ€§å¤±ç¦ã€‚è€ƒæ…®è—¥ç‰©æ²»ç™‚ã€‚',
                            'é »ç¹ç™¼ä½œï¼ˆFrequent Episodesï¼‰': 'è¨˜éŒ„æ—¥èªŒï¼Œå°‹æ±‚æ³Œå°¿ç§‘å”åŠ©ã€‚'
                        }
                    },
                    'æ’å°¿å›°é›£ï¼ˆVoiding Difficultyï¼‰': {
                        description: 'è¡¨ç¾ç‚ºè§£å°¿è²»åŠ›ã€å°¿æµè®Šç´°ã€é²ç·©ã€æ–·çºŒã€é¤˜å°¿æ„Ÿã€‚å¸¸è¦‹æ–¼æ”è­·è…ºè‚¥å¤§ã€å°¿é“ç‹¹çª„ã€‚éœ€æµé‡æª¢æŸ¥ã€‚',
                        subsymptoms: {
                            'èµ·å§‹å»¶é²ï¼ˆHesitancyï¼‰': 'å¸¸è¦‹æ–¼å‰åˆ—è…ºè‚¥å¤§ã€‚å»ºè­°alphaé˜»æ–·åŠ‘ã€‚',
                            'å°¿æµä¸­æ–·ï¼ˆIntermittencyï¼‰': 'å¯èƒ½å°¿é“ç‹¹çª„ã€‚éœ€å½±åƒå­¸æª¢æŸ¥ã€‚',
                            'é¤˜å°¿æ„Ÿï¼ˆPost-void Dribblingï¼‰': 'æš—ç¤ºè†€èƒ±é ¸å•é¡Œã€‚é€²è¡Œæ®˜å°¿é‡æ¸¬é‡ã€‚'
                        }
                    },
                }
            },
            'å°¿æ¶²ç•°å¸¸ï¼ˆUrine Abnormalitiesï¼‰': {
                icon: 'ğŸ©¸',
                symptoms: {
                    'è¡€å°¿ï¼ˆHematuriaï¼‰': {
                        description: 'åŒ…æ‹¬é¡¯å¾®è¡€å°¿ã€è‚‰çœ¼è¡€å°¿ã€‚éœ€è­¦è¦ºæ„ŸæŸ“ã€çµçŸ³ã€è…«ç˜¤ã€‚å°¤å…¶å¹´é•·è€…ï¼Œéœ€ç«‹å³æ’é™¤æƒ¡æ€§è…«ç˜¤ã€‚',
                        subsymptoms: {
                            'è‚‰çœ¼è¡€å°¿ï¼ˆGross Hematuriaï¼‰': 'ç„¡è«–æ˜¯å¦ç–¼ç—›ï¼Œéƒ½æ˜¯åš´é‡å¾µå…†ã€‚è«‹åœ¨24å°æ™‚å…§çœ‹æ³Œå°¿ç§‘ã€‚',
                            'é¡¯å¾®è¡€å°¿ï¼ˆMicroscopic Hematuriaï¼‰': 'é€šå¸¸å¥åº·æª¢æŸ¥ç™¼ç¾ã€‚è‹¥åˆä½µè›‹ç™½å°¿ï¼Œéœ€æª¢æŸ¥è…è‡Ÿç—…è®Šã€‚',
                            'é–“æ­‡æ€§ï¼ˆIntermittentï¼‰': 'æª¢æŸ¥å‡è¡€åŠŸèƒ½æˆ–å½±åƒå­¸ã€‚'
                        }
                    },
                    'è†¿å°¿/å°¿æ¶²æ··æ¿æˆ–ç•°å‘³ï¼ˆPyuria/Cloudy or Odorous Urineï¼‰': {
                        description: 'å¤šæ•¸èˆ‡æ„ŸæŸ“æˆ–è„«æ°´æœ‰é—œã€‚è‹¥ä¼´éš¨ç™¼ç‡’ï¼Œæ‡‰å„˜å¿«é€²è¡Œå°¿æ¶²åˆ†æåŠç´°èŒåŸ¹é¤Šã€‚',
                        subsymptoms: {
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'é«˜åº¦æ‡·ç–‘UTIã€‚ç«‹å³æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'è„«æ°´ç›¸é—œï¼ˆDehydration-relatedï¼‰': 'å¢åŠ é£²æ°´ï¼Œé¿å…é«˜è›‹ç™½é£²é£Ÿã€‚',
                            'ç•°å‘³å¼·çƒˆï¼ˆStrong Odorï¼‰': 'å¯èƒ½ç´°èŒæ„ŸæŸ“ã€‚å°¿åŸ¹é¤Šæª¢æŸ¥ã€‚'
                        }
                    },
                    'å°¿æ¶²å¸¶æ³¡ï¼ˆFoamy Urineï¼‰': {
                        description: 'æç¤ºè›‹ç™½å°¿ï¼Œå¯èƒ½ç³»çµ±æ€§ç–¾ç—…å¦‚è…è‡Ÿç—…ã€‚éœ€è¡€æ¶²åŠ24å°æ™‚å°¿æ¶²æª¢æŸ¥è©•ä¼°è…åŠŸèƒ½ã€‚',
                        subsymptoms: {
                            'æŒçºŒä¸æ•£ï¼ˆPersistentï¼‰': 'æš—ç¤ºå¤§é‡è›‹ç™½å°¿ã€‚æª¢æŸ¥ç³–å°¿ç—…æˆ–é«˜è¡€å£“ã€‚',
                            'åˆä½µæ°´è…«ï¼ˆWith Edemaï¼‰': 'è…ç—…ç—‡å€™ç¾¤ã€‚è…åŠŸèƒ½æª¢æŸ¥ã€‚',
                            'å®¶æ—å²ï¼ˆFamilialï¼‰': 'è€ƒæ…®éºå‚³æ€§è…ç—…ã€‚'
                        }
                    },
                }
            },
            'ç–¼ç—›ç›¸é—œï¼ˆPain-Relatedï¼‰': {
                icon: 'âš ï¸',
                symptoms: {
                    'è…°ç—›/è‚‹è„Šè§’ç—›ï¼ˆFlank Pain/Costovertebral Angle Tendernessï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è…ç›‚è…ç‚ã€è…çµçŸ³ã€‚æœ‰æ™‚ç‚ºæ€¥ç—‡ï¼Œéœ€å¿«é€Ÿåˆ¤æ–·ã€‚',
                        subsymptoms: {
                            'åŠ‡ç—›çªç™¼ï¼ˆSevere Sudden Painï¼‰': 'å¼·çƒˆæ‡·ç–‘è…çµç—›ã€‚ç«‹å³æ›æ€¥è¨ºã€‚',
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'æ’é™¤è…ç›‚è…ç‚ã€‚æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'åè¦†ç™¼ä½œï¼ˆRecurrentï¼‰': 'æª¢æŸ¥çµçŸ³ä»£è¬ç•°å¸¸ã€‚'
                        }
                    },
                    'ä¸‹è…¹ç—›/æœƒé™°ç—›ï¼ˆSuprapubic/Perineal Painï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è†€èƒ±ç‚ã€æ”è­·è…ºç‚ã€‚å»ºè­°è¨˜éŒ„ç–¼ç—›æ—¥èªŒï¼Œå°‹æ±‚ç–¼ç—›ç§‘/æ³Œå°¿ç§‘å”åŠ©ã€‚',
                        subsymptoms: {
                            'æ’å°¿æ™‚åŠ åŠ‡ï¼ˆWorsens with Urinationï¼‰': 'å¯èƒ½è†€èƒ±ç‚ã€‚å°¿åŸ¹é¤Šã€‚',
                            'æ…¢æ€§ç–¼ç—›ï¼ˆChronicï¼‰': 'ç”·æ€§è€ƒæ…®æ…¢æ€§å‰åˆ—è…ºç‚ï¼›å¥³æ€§æ’é™¤é–“è³ªæ€§è†€èƒ±ç‚ã€‚',
                            'å±€éƒ¨è…«è„¹ï¼ˆLocalized Swellingï¼‰': 'æª¢æŸ¥æ„ŸæŸ“æˆ–é˜»å¡ã€‚'
                        }
                    },
                    'çªä¸¸ç—›/é™°å›Šè…«è„¹ï¼ˆTesticular Pain/Scrotal Swellingï¼‰': {
                        description: 'å¸¸è¦‹æ–¼å‰¯çªç‚ã€çªä¸¸æ‰­è½‰ã€‚éœ€å¿«é€Ÿåˆ¤æ–·ï¼Œå¯èƒ½ç‚ºæ€¥ç—‡ã€‚',
                        isMaleOnly: true, 
                        subsymptoms: {
                            'çªç™¼åŠ‡ç—›ï¼ˆSudden Severe Painï¼‰': 'æ‡·ç–‘çªä¸¸æ‰­è½‰ã€‚ç«‹å³æ‰‹è¡“ã€‚',
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'å‰¯çªç‚ã€‚æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'è…«è„¹æ˜é¡¯ï¼ˆObvious Swellingï¼‰': 'è¶…éŸ³æ³¢æª¢æŸ¥æ’é™¤è…«ç˜¤ã€‚'
                        }
                    },
                    'å…¨èº«æ€§ç™¼ç‡’/å¯’é¡«ï¼ˆSystemic Fever/Chillsï¼‰': {
                        description: 'å…¨èº«æ€§ç™¼ç‡’ï¼ˆ>38Â°Cï¼‰æˆ–ç•å¯’ã€‚åœ¨æ³Œå°¿ç³»çµ±ä¸­ï¼Œé€™é«˜åº¦æš—ç¤ºå­˜åœ¨æ€¥æ€§æ„ŸæŸ“ï¼Œå¦‚è…ç›‚è…ç‚ã€æ€¥æ€§å‰åˆ—è…ºç‚æˆ–å‰¯çªç‚ã€‚å¿…é ˆç«‹å³å°±é†«ã€‚',
                        subsymptoms: {
                            'é«˜ç‡’æŒçºŒï¼ˆSustained High Feverï¼‰': 'ç«‹å³æ€¥è¨ºæª¢æŸ¥è¡€å¸¸è¦åŠå°¿æ¶²ï¼Œæ’é™¤æ•—è¡€ç—‡ã€‚',
                            'ä¼´éš¨ç•å¯’/ç™¼æŠ–ï¼ˆWith Chills/Rigorsï¼‰': 'æç¤ºèŒè¡€ç—‡é¢¨éšªé«˜ï¼Œå»ºè­°éœè„ˆæŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'ç„¡å…¶ä»–æ³Œå°¿ç—‡ç‹€ï¼ˆNo Other Urinary Symptomsï¼‰': 'éœ€æ’é™¤éæ³Œå°¿ç³»çµ±æ„ŸæŸ“ï¼Œå¦‚æµæ„Ÿæˆ–æ–°å† è‚ºç‚ã€‚'
                        }
                    },
                }
            },
            'ç”Ÿæ®–é“èˆ‡æ€§å¥åº·ï¼ˆGenital & Sexual Healthï¼‰': {
                icon: 'ğŸ¦ ', 
                symptoms: {
                    // *** ç”·æ€§å°ˆå±¬ç—‡ç‹€ ***
                    'å°¿é“åˆ†æ³Œç‰©ï¼ˆUrethral Dischargeï¼‰': {
                        description: 'å¸¸è¦‹æ–¼æ€§å‚³æ’­æ„ŸæŸ“ï¼ˆå¦‚æ·‹ç—…ã€è¡£åŸé«”ç­‰ï¼‰æˆ–å°¿é“ç‚ï¼Œéœ€é€²è¡Œå°¿é“æˆ–åˆ†æ³Œç‰©åŸ¹é¤Šæª¢æŸ¥ä»¥ç¢ºå®šç—…åŸé«”ã€‚è«‹å‘ŠçŸ¥é†«å¸«æ˜¯å¦æœ‰ä¸å®‰å…¨æ€§è¡Œç‚ºå²ã€‚',
                        isMaleOnly: true, 
                        subsymptoms: {
                            'é»ƒ/ç¶ è‰²æ¿ƒç¨ åˆ†æ³Œç‰©ï¼ˆThick Yellow/Green Dischargeï¼‰': 'é«˜åº¦æ‡·ç–‘æ·‹ç—…æ€§å°¿é“ç‚ï¼ˆGonococcal Urethritisï¼‰ã€‚éœ€ç«‹å³æŠ—ç”Ÿç´ æ²»ç™‚åŠè¿½è¹¤ã€‚',
                            'ç™½è‰²æ¸…æ¾ˆç¨€è–„åˆ†æ³Œç‰©ï¼ˆClear Thin White Dischargeï¼‰': 'å¸¸è¦‹æ–¼éæ·‹ç—…æ€§å°¿é“ç‚ï¼ˆNon-Gonococcal Urethritis, NGUï¼‰ï¼Œå¦‚è¡£åŸé«”æ„ŸæŸ“ã€‚',
                            'ä¼´éš¨ç™¼ç™¢æˆ–ç¼ç†±ï¼ˆWith Itching or Burningï¼‰': 'å¯èƒ½ç‚ºå–®ç´”çš°ç–¹æˆ–å…¶ä»–ç—…æ¯’æ„ŸæŸ“ã€‚',
                            'åƒ…æ¸…æ™¨åˆ†æ³Œç‰©ï¼ˆMorning Discharge Onlyï¼‰': 'å¸¸è¦‹æ–¼NGUã€‚å»ºè­°é€²è¡Œæ ¸é…¸æª¢æ¸¬ï¼ˆNAATï¼‰ã€‚',
                        }
                    },
                    'å‹ƒèµ·åŠŸèƒ½éšœç¤™/æ—©æ´©ï¼ˆErectile Dysfunction/Premature Ejaculationï¼‰': {
                        description: 'æ¶‰åŠæ³Œå°¿èˆ‡ç”Ÿæ®–åŠŸèƒ½ï¼Œå½±éŸ¿ç”Ÿæ´»å“è³ªã€‚å¯èƒ½èˆ‡æ”è­·è…ºå•é¡Œæˆ–è¡€ç®¡ç–¾ç—…ç›¸é—œã€‚',
                        isMaleOnly: true, 
                        subsymptoms: {
                            'æŒçºŒæ€§éšœç¤™ï¼ˆPersistent EDï¼‰': 'æª¢æŸ¥å¿ƒè¡€ç®¡é¢¨éšªã€‚è€ƒæ…®PDE5æŠ‘åˆ¶åŠ‘ã€‚',
                            'å¿ƒç†å› ç´ ï¼ˆPsychogenicï¼‰': 'å£“åŠ›ç›¸é—œã€‚å¿ƒç†è«®è©¢ã€‚',
                            'ä¼´éš¨å…¶ä»–ç—‡ç‹€ï¼ˆWith Other Symptomsï¼‰': 'å¦‚ç³–å°¿ç—…ã€‚ç¶œåˆè©•ä¼°ã€‚'
                        }
                    },
                    'è¡€ç²¾ç—‡ï¼ˆHemospermiaï¼‰': {
                        description: 'è¡€ç²¾ç—‡ã€‚éœ€æ’é™¤æ„ŸæŸ“ã€è…«ç˜¤æˆ–å¤–å‚·ã€‚å½±éŸ¿ç”Ÿè‚²ã€‚',
                        isMaleOnly: true, 
                        subsymptoms: {
                            'å–®æ¬¡ç™¼ç”Ÿï¼ˆSingle Episodeï¼‰': 'é€šå¸¸è‰¯æ€§ã€‚è§€å¯Ÿã€‚',
                            'åè¦†ï¼ˆRecurrentï¼‰': 'å‰åˆ—è…ºæª¢æŸ¥æˆ–è¶…éŸ³æ³¢ã€‚',
                            'ä¼´éš¨ç–¼ç—›ï¼ˆWith Painï¼‰': 'å¯èƒ½æ„ŸæŸ“ã€‚æŠ—ç”Ÿç´ ã€‚'
                        }
                    },
                    'ç”·æ€§ä¸å­•ç—‡ï¼ˆMale Infertilityï¼‰': {
                        description: 'å°‘ç²¾ç—‡ã€ç„¡ç²¾ç—‡ä¼´éš¨æ³Œå°¿ç³»ç•°å¸¸ã€‚å½±éŸ¿ç”Ÿè‚²ï¼Œéœ€ç²¾æ¶²åˆ†æã€‚',
                        isMaleOnly: true, 
                        subsymptoms: {
                            'å°‘ç²¾ç—‡ï¼ˆOligospermiaï¼‰': 'æª¢æŸ¥è·çˆ¾è’™æˆ–éºå‚³ã€‚',
                            'ç„¡ç²¾ç—‡ï¼ˆAzoospermiaï¼‰': 'æ’é™¤é˜»å¡æˆ–çªä¸¸å•é¡Œã€‚æ‰‹è¡“è©•ä¼°ã€‚',
                            'ä¼´éš¨æ³Œå°¿ç—‡ç‹€ï¼ˆWith Urological Symptomsï¼‰': 'å¦‚æ”è­·è…ºè‚¥å¤§ã€‚ç¶œåˆæ²»ç™‚ã€‚'
                        }
                    },
                    // *** å¥³æ€§å°ˆå±¬ç—‡ç‹€ ***
                    'é™°é“åˆ†æ³Œç‰©ç•°å¸¸ï¼ˆAbnormal Vaginal Dischargeï¼‰': {
                        description: 'åŒ…æ‹¬é¡è‰²ã€æ°£å‘³ã€é‡çš„è®ŠåŒ–ï¼Œå¸¸èˆ‡é™°é“ç‚ï¼ˆç´°èŒã€é»´èŒï¼‰ã€å­å®®é ¸ç‚æˆ–éª¨ç›†è…”æ„ŸæŸ“ç›¸é—œã€‚æ³Œå°¿ç§‘ä¸»è¦é‘‘åˆ¥æ˜¯å¦ç‚ºæ³Œå°¿é“æ„ŸæŸ“ä½µç™¼ã€‚',
                        isFemaleOnly: true, 
                        subsymptoms: {
                            'è±†è…æ¸£æ¨£åˆ†æ³Œç‰©ï¼ˆCurd-like Dischargeï¼‰': 'é«˜åº¦æç¤ºé»´èŒæ„ŸæŸ“ï¼ˆå¿µç èŒï¼‰ã€‚å±€éƒ¨æŠ—é»´èŒè—¥è†ã€‚',
                            'é­šè…¥å‘³ï¼ˆFishy Odorï¼‰': 'æç¤ºç´°èŒæ€§é™°é“ç—…ã€‚å£æœæˆ–å±€éƒ¨æŠ—ç”Ÿç´ ã€‚',
                            'é»ƒè‰²æˆ–ç¶ è‰²åˆ†æ³Œç‰©ï¼ˆYellow or Green Dischargeï¼‰': 'éœ€æ’é™¤æ»´èŸ²æˆ–æ·‹ç—…æ„ŸæŸ“ã€‚å»ºè­°å©¦ç§‘æˆ–æ€§ç—…æª¢æŸ¥ã€‚',
                            'åˆä½µè…¹ç—›ï¼ˆWith Abdominal Painï¼‰': 'éœ€æ’é™¤éª¨ç›†è…”ç™¼ç‚ï¼ˆPIDï¼‰ã€‚ç«‹å³å°±é†«ã€‚'
                        }
                    },
                    'å¤–é™°/é™°é“ç–¼ç—›æˆ–ç™¼ç™¢ï¼ˆVulvar/Vaginal Pain or Itchingï¼‰': {
                        description: 'å¸¸è¦‹æ–¼é»´èŒæ„ŸæŸ“ã€æ¥è§¸æ€§çš®è†šç‚ã€å¤–é™°ç‚æˆ–å·´æ°è…ºå›Šè…«ã€‚è‹¥åˆä½µæ’å°¿ç—›ï¼Œå¯èƒ½ç‚ºæ³Œå°¿é“æ„ŸæŸ“ï¼ˆUTIï¼‰é€£å¸¶åˆºæ¿€ã€‚',
                        isFemaleOnly: true, 
                        subsymptoms: {
                            'ç™¼ç™¢åŠ‡çƒˆï¼ˆSevere Itchingï¼‰': 'æç¤ºé»´èŒæ„ŸæŸ“æˆ–æ¿•ç–¹ã€‚',
                            'ç¼ç†±æ„Ÿï¼ˆBurning Sensationï¼‰': 'å¯èƒ½æ¥è§¸æ€§éæ•æˆ–ç´°èŒæ„ŸæŸ“ã€‚',
                            'å±€éƒ¨è…«å¡Šï¼ˆLocalized Lumpï¼‰': 'æª¢æŸ¥æ˜¯å¦ç‚ºå·´æ°è…ºè†¿ç˜æˆ–å›Šè…«ã€‚',
                            'ä¹¾ç‡¥èˆ‡èç¸®ï¼ˆDryness and Atrophyï¼‰': 'èˆ‡æ›´å¹´æœŸè·çˆ¾è’™ç›¸é—œï¼Œè€ƒæ…®å±€éƒ¨é›Œæ¿€ç´ ã€‚'
                        }
                    },
                    'æ€§äº¤ç–¼ç—›ï¼ˆDyspareuniaï¼‰': {
                        description: 'æ€§è¡Œç‚ºæ™‚æ„Ÿåˆ°ç–¼ç—›ã€‚åˆ†ç‚ºæ·ºå±¤ï¼ˆé™°é“å£ï¼‰èˆ‡æ·±å±¤ï¼ˆå­å®®é ¸ï¼‰ã€‚å¯èƒ½èˆ‡UTIã€é™°é“ç‚ã€å­å®®å…§è†œç•°ä½ã€æˆ–é–“è³ªæ€§è†€èƒ±ç‚ç›¸é—œã€‚',
                        isFemaleOnly: true, 
                        subsymptoms: {
                            'æ·ºå±¤ç–¼ç—›ï¼ˆSuperficial Painï¼‰': 'å¯èƒ½é™°é“ç—™æ”£æˆ–å¤–é™°ç‚ã€‚å±€éƒ¨æ­¢ç—›èˆ‡ç‰©ç†æ²»ç™‚ã€‚',
                            'æ·±å±¤ç–¼ç—›ï¼ˆDeep Painï¼‰': 'éœ€æ’é™¤å­å®®å…§è†œç•°ä½æˆ–éª¨ç›†è…”æ²¾é»ã€‚å»ºè­°å©¦ç§‘è¶…éŸ³æ³¢ã€‚',
                            'æ’å°¿å¾Œç–¼ç—›ï¼ˆPain after Intercourseï¼‰': 'å¯èƒ½ç‚ºæ€§è¡Œç‚ºå¼•èµ·çš„æ³Œå°¿é“åˆºæ¿€ã€‚å¤šé£²æ°´ã€‚'
                        }
                    },
                    'æ…¢æ€§éª¨ç›†è…”ç–¼ç—›ï¼ˆChronic Pelvic Painï¼‰': {
                        description: 'æŒçºŒè¶…éå…­å€‹æœˆã€éé€±æœŸæ€§çš„ä¸‹è…¹éƒ¨ç–¼ç—›ã€‚é€™æ˜¯ä¸€å€‹è¤‡é›œçš„è¨ºæ–·ï¼Œæ¶‰åŠæ³Œå°¿ã€å©¦ç§‘ã€æ¶ˆåŒ–ç³»çµ±ï¼Œå¸¸è¦‹æ–¼é–“è³ªæ€§è†€èƒ±ç‚ã€æ…¢æ€§ç›†è…”ç‚ç—‡å€™ç¾¤ã€‚',
                        isFemaleOnly: true, 
                        subsymptoms: {
                            'ç–¼ç—›ä½ç½®ä¸ç¢ºå®šï¼ˆVague Pain Locationï¼‰': 'éœ€ç¶œåˆè©•ä¼°ã€‚è€ƒæ…®ç¥ç¶“æ€§ç–¼ç—›ã€‚',
                            'æ’å°¿/è†€èƒ±è„¹æ»¿æ™‚åŠ é‡ï¼ˆWorsens with Bladder Fullnessï¼‰': 'é«˜åº¦æ‡·ç–‘é–“è³ªæ€§è†€èƒ±ç‚ã€‚å»ºè­°è†€èƒ±é¡æª¢æŸ¥ã€‚',
                            'åˆä½µç¶“ç—›ï¼ˆCombined with Dysmenorrheaï¼‰': 'éœ€æ’é™¤å­å®®å…§è†œç•°ä½ç—‡ã€‚',
                            'å½±éŸ¿æ—¥å¸¸ç”Ÿæ´»ï¼ˆAffecting Daily Lifeï¼‰': 'å¤šç§‘æœƒè¨ºï¼Œå¦‚ç–¼ç—›ç§‘ã€‚'
                        }
                    },
                }
            }
        };

        const GENDER_OPTIONS = {
            'ç”·æ€§ (â™‚)': 'MALE',
            'å¥³æ€§ (â™€)': 'FEMALE'
        };

        
        /**
         * æ ¹æ“šæ€§åˆ¥éæ¿¾ç‰¹å®šé¡åˆ¥ä¸‹çš„ç—‡ç‹€
         * @param {string} categoryName 
         * @returns {object} éæ¿¾å¾Œçš„ç—‡ç‹€ç‰©ä»¶
         */
        function getFilteredSymptoms(categoryName) {
            const symptoms = JSON.parse(JSON.stringify(data[categoryName].symptoms)); 
            
            for (const symptomName in symptoms) {
                const symptomData = symptoms[symptomName];

                if (selectedGender === 'FEMALE') {
                    if (symptomData.isMaleOnly || symptomName === 'çªä¸¸ç—›/é™°å›Šè…«è„¹ï¼ˆTesticular Pain/Scrotal Swellingï¼‰') {
                        delete symptoms[symptomName];
                    }
                } else if (selectedGender === 'MALE') {
                    if (symptomData.isFemaleOnly) {
                        delete symptoms[symptomName];
                    }
                }
            }
            return symptoms;
        }

        /**
         * æ ¹æ“šæ€§åˆ¥æ›¿æ›å»ºè­°ä¸­çš„å°ˆå±¬åè©
         * @param {string} adviceText - åŸå§‹å»ºè­°æ–‡å­—
         * @param {string} gender - 'MALE' or 'FEMALE'
         * @returns {string} æ›¿æ›å¾Œçš„æ–‡å­—
         */
        function getGenderSpecificAdvice(adviceText, gender) {
            if (gender === 'FEMALE') {
                let text = adviceText;
                text = text.replace(/æ”è­·è…ºè‚¥å¤§/g, 'è†€èƒ±é ¸é˜»å¡/å¢åš');
                text = text.replace(/å‰åˆ—è…ºç‚/g, 'é–“è³ªæ€§è†€èƒ±ç‚/æ…¢æ€§éª¨ç›†ç–¼ç—›ç¶œåˆç—‡');
                text = text.replace(/æ€¥æ€§å‰åˆ—è…ºç‚/g, 'åš´é‡æ³Œå°¿é“æ„ŸæŸ“/è…ç›‚è…ç‚');
                text = text.replace(/ç”·æ€§è€ƒæ…®æ…¢æ€§å‰åˆ—è…ºç‚ï¼›å¥³æ€§æ’é™¤é–“è³ªæ€§è†€èƒ±ç‚/g, 'éœ€æ’é™¤é–“è³ªæ€§è†€èƒ±ç‚/æ…¢æ€§éª¨ç›†ç–¼ç—›ç¶œåˆç—‡');
                text = text.replace(/å°¿é“ç‚æˆ–é¾œé ­ç‚/g, 'å°¿é“ç‚æˆ–ç”Ÿæ®–å™¨ç‚ç—‡');
                text = text.replace(/å‰¯çªç‚/g, 'ç”Ÿæ®–ç³»çµ±ç‚ç—‡');
                return text;
            }
            return adviceText; 
        }

        /**
         * æ›´æ–°é¡¯ç¤ºè¢å¹•ä¸Šçš„æ–‡å­—å’Œç‹€æ…‹
         * @param {string} instruction 
         * @param {string} selection 
         */
        function updateDisplay(instruction, selection = '') {
            instructionText.textContent = instruction;
            selectionText.textContent = selection;
        }

        /**
         * æ¸²æŸ“å¯é¸çš„æŒ‰éˆ•åˆ—è¡¨
         */
        function renderOptions(optionsMap, type) {
            optionsGrid.innerHTML = '';
            
            const keys = Object.keys(optionsMap);
            const cols = (type === 'gender' || type === 'category') ? 2 : (keys.length > 2 ? 2 : 1);
            optionsGrid.className = `grid grid-cols-${cols} sm:grid-cols-2 gap-4 mb-6`;
            
            keys.forEach(key => {
                const option = optionsMap[key];
                const button = document.createElement('button');
                const buttonText = type === 'category' ? `${option.icon} ${key}` : key;
                button.textContent = buttonText.replace(/ï¼ˆ[^ï¼‰]+ï¼‰/g, ''); 
                
                button.dataset.value = (type === 'gender') ? option : key; 
                
                button.classList.add(
                    'item-button', 
                    'p-4', 
                    'rounded-xl', 
                    'text-base', 
                    'sm:text-lg', 
                    'font-bold', 
                    'text-gray-200',
                    'shadow-lg',
                    'border-2',
                    'border-gray-700',
                    'break-words'
                );
                
                // æ–°å¢ï¼šåƒ…åœ¨æœå‹™å•Ÿç”¨ä¸”ç‚ºæ€§åˆ¥é¸æ“‡éšæ®µæ™‚å•Ÿç”¨æŒ‰éˆ•
                if (type === 'gender' && !isServiceActive) {
                    button.disabled = true;
                    button.classList.add('gender-button'); // æ·»åŠ æ¨™è¨˜ class
                }

                if (type === 'gender' && selectedGender === button.dataset.value) {
                    button.classList.add('selected', 'text-gray-900');
                    button.classList.remove('item-button', 'text-gray-200');
                } else if (type === 'category' && selectedCategory === key) {
                    button.classList.add('selected', 'text-gray-900');
                    button.classList.remove('item-button', 'text-gray-200');
                } else if (type === 'symptom' && selectedSymptom === key) {
                    button.classList.add('selected', 'text-gray-900');
                    button.classList.remove('item-button', 'text-gray-200');
                } else if (type === 'subsymptom' && selectedSubsymptoms.includes(key)) {
                    button.classList.add('selected', 'text-gray-900');
                    button.classList.remove('item-button', 'text-gray-200');
                }

                button.addEventListener('click', () => {
                    if (type === 'gender') handleGenderSelect(button.dataset.value);
                    else if (type === 'category') handleCategorySelect(key);
                    else if (type === 'symptom') handleSymptomSelect(key);
                    else if (type === 'subsymptom') handleSubsymptomToggle(key, button);
                });
                optionsGrid.appendChild(button);
            });
        }

        function handleGenderSelect(genderValue) {
            selectedGender = genderValue;
            gameState = 'CATEGORY';

            const categories = {};
            for (const key in data) {
                categories[key] = { icon: data[key].icon };
            }

            renderOptions(categories, 'category');
            
            const genderDisplay = genderValue === 'MALE' ? 'ç”·æ€§ (â™‚)' : 'å¥³æ€§ (â™€)';
            updateDisplay(`è«‹é¸æ“‡æ‚¨çš„ä¸»è¦ä¸é©é¡åˆ¥...`, `[æ€§åˆ¥]: ${genderDisplay}`);
            backButton.classList.add('hidden'); 
            confirmButton.disabled = true; 
        }

        function handleCategorySelect(categoryName) {
            selectedCategory = categoryName;
            selectedSymptom = null; 
            selectedSubsymptoms = []; 
            gameState = 'SYMPTOM';
            
            const symptoms = getFilteredSymptoms(categoryName);
            
            renderOptions(symptoms, 'symptom');
            const genderDisplay = selectedGender === 'MALE' ? 'ç”·æ€§ (â™‚)' : 'å¥³æ€§ (â™€)';
            updateDisplay(`è«‹é¸æ“‡æ‚¨çš„å…·é«”ç—‡ç‹€:`, `[æ€§åˆ¥]: ${genderDisplay} | [é¡åˆ¥]: ${categoryName}`);
            confirmButton.disabled = true;
            backButton.classList.remove('hidden'); 
            
            resultCard.classList.add('hidden');
            resultCard.style.display = 'none';
            resultCard.classList.remove('print-animation');
            redDivider.classList.remove('flashing-neon-divider'); 
        }

        function handleSymptomSelect(symptomName) {
            selectedSymptom = symptomName;
            selectedSubsymptoms = []; 
            gameState = 'SUBSYMPTOM';
            
            const subsymptoms = data[selectedCategory].symptoms[symptomName].subsymptoms; 
            renderOptions(subsymptoms, 'subsymptom');
            const genderDisplay = selectedGender === 'MALE' ? 'ç”·æ€§ (â™‚)' : 'å¥³æ€§ (â™€)';
            updateDisplay(`è«‹é¸æ“‡ç›¸é—œçš„å­ç—‡ç‹€ (å¯å¤šé¸):`, `[ç—‡ç‹€]: ${symptomName} | [æ€§åˆ¥]: ${genderDisplay}`);
            confirmButton.disabled = true; 
        }

        function handleSubsymptomToggle(subsymptomName, button) {
            const index = selectedSubsymptoms.indexOf(subsymptomName);

            if (index > -1) {
                selectedSubsymptoms.splice(index, 1);
                button.classList.remove('selected', 'text-gray-900');
                button.classList.add('item-button', 'text-gray-200');
            } else {
                selectedSubsymptoms.push(subsymptomName);
                button.classList.add('selected', 'text-gray-900');
                button.classList.remove('item-button', 'text-gray-200');
            }

            const baseInfo = `[ç—‡ç‹€]: ${selectedSymptom} | [æ€§åˆ¥]: ${selectedGender === 'MALE' ? 'ç”·æ€§ (â™‚)' : 'å¥³æ€§ (â™€)'}`;
            selectionText.textContent = baseInfo + ` | [å·²é¸å­é …ç›®]: ${selectedSubsymptoms.join('ã€') || 'ç„¡'}`;
            
            confirmButton.disabled = selectedSubsymptoms.length === 0;
        }

        /**
         * è™•ç†ç¢ºèªæŒ‰éˆ•é»æ“Š (é€²è¡Œæ¨¡æ“¬è¨ºæ–·)
         */
        confirmButton.addEventListener('click', () => {
            if (gameState !== 'SUBSYMPTOM' || selectedSubsymptoms.length === 0) return;

            gameState = 'PROCESSING';
            confirmButton.disabled = true;
            backButton.classList.add('hidden');
            optionsGrid.innerHTML = '';
            
            updateDisplay('â–ˆâ–ˆâ–ˆâ–ˆ æƒæèˆ‡è™•ç†ä¸­... â–ˆâ–ˆâ–ˆâ–ˆ', 'ç³»çµ±æ­£åœ¨åŒ¹é…æœ€ç›¸é—œçš„å¥åº·è³‡è¨Šï¼Œè«‹ç¨å€™...');

            resultCard.classList.add('hidden');
            resultCard.style.display = 'none';
            resultCard.classList.remove('print-animation');
            redDivider.classList.remove('flashing-neon-divider'); 
            
            clearTimeout(neonTimeout); 

            setTimeout(() => {
                simulateDiagnosis();
            }, 3000);
        });

        /**
         * æ¨¡æ“¬è¨ºæ–·ä¸¦é¡¯ç¤ºçµæœå¡
         */
        function simulateDiagnosis() {
            try {
                gameState = 'RESULT';
                
                if (!selectedCategory || !selectedSymptom || !data[selectedCategory].symptoms[selectedSymptom] || selectedSubsymptoms.length === 0) {
                    throw new Error("è¨ºæ–·æ•¸æ“šä¸è¶³æˆ–ç„¡æ•ˆã€‚è«‹é‡æ–°é–‹å§‹ã€‚");
                }

                const symptomData = data[selectedCategory].symptoms[selectedSymptom];
                const subsymptomsMap = symptomData.subsymptoms;
                
                let combinedAdvice = `<ul>`;
                combinedAdvice += selectedSubsymptoms.map(sub => {
                    let advice = subsymptomsMap[sub] || 'æ­¤å­ç—‡ç‹€ç„¡ç‰¹å®šæ¨¡æ“¬å»ºè­°ã€‚';
                    advice = getGenderSpecificAdvice(advice, selectedGender); 
                    return `<li class="mb-2"><span class="font-extrabold text-blue-900">${sub}</span>: ${advice}</li>`;
                }).join('');
                combinedAdvice += `</ul>`;
                
                const diagnosisTitle = `è¨ºæ–·ä»£ç¢¼: URO-${Math.floor(Math.random() * 900) + 100} - åˆæ­¥å°ˆæ¥­å»ºè­°`;
                const genderLabel = selectedGender === 'MALE' ? 'ç”·æ€§' : 'å¥³æ€§';
                let diagnosisContent = `<p class="font-medium mb-1">æ‚¨çš„é¸æ“‡ [${genderLabel}] é›†ä¸­åœ¨ï¼š<span class="text-red-700">${selectedCategory} - ${selectedSymptom}</span>ã€‚</p>`;
                
                let mainDescription = getGenderSpecificAdvice(symptomData.description, selectedGender);

                diagnosisContent += `<span class="font-bold text-red-700 block mt-3">ã€é¦–è¦å»ºè­°èˆ‡é‘‘åˆ¥ã€‘</span><p class="font-medium mt-1">${mainDescription}</p>`;
                diagnosisContent += `<span class="font-bold text-red-700 block mt-3">ã€ç´°ç¯€ç—‡ç‹€èˆ‡å»ºè­°ã€‘</span><div class="mt-1 text-sm space-y-1">${combinedAdvice}</div>`;
                
                cardTitle.textContent = diagnosisTitle;
                cardContent.innerHTML = diagnosisContent;

                // 1. æ’­æ”¾éŸ³æ•ˆ (å…©è²ç°¡çŸ­é›»å­éŸ³)
                playPrintSound();
                
                // 2. æ‡‰ç”¨éœ“è™¹é–ƒçˆæ•ˆæœåˆ°ç´…ç·š
                redDivider.classList.add('flashing-neon-divider');

                // 3. é¡¯ç¤ºçµæœå¡ä¸¦æ‡‰ç”¨å‡ºç´™å‹•ç•« (å‹•ç•«æŒçºŒ 1.5s)
                resultCard.classList.remove('hidden');
                resultCard.style.display = 'block';
                resultCard.classList.add('print-animation');

                updateDisplay(`å»ºè­°å¡å·²å‡ºçˆ! è«‹å–èµ°`, `è«‹è©³é–±å»ºè­°ä¸¦å„˜é€Ÿå°±é†«ã€‚`);
                
                // 4. å®šæ™‚å™¨ï¼šåœ¨ 5 ç§’ (5000ms) å¾Œåœæ­¢éœ“è™¹é–ƒçˆæ•ˆæœ
                neonTimeout = setTimeout(() => {
                    redDivider.classList.remove('flashing-neon-divider');
                    console.log("éœ“è™¹é–ƒçˆå·²åœæ­¢ã€‚");
                }, 5000); 

                console.log("è¨ºæ–·å®Œæˆï¼Œçµæœå¡å·²å˜—è©¦é¡¯ç¤ºã€‚");
                backButton.classList.add('hidden');

            } catch (error) {
                console.error("æ¨¡æ“¬è¨ºæ–·å‡ºéŒ¯:", error);
                cardTitle.textContent = "ç³»çµ±éŒ¯èª¤ (Error)";
                cardContent.innerHTML = `<p class="text-red-500 font-bold">ç„¡æ³•å®Œæˆè¨ºæ–·ã€‚è«‹é»æ“Šã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ•ã€‚</p><p class="mt-2 text-xs">æŠ€è¡“è¨Šæ¯: ${error.message}</p>`;
                resultCard.classList.remove('hidden');
                resultCard.style.display = 'block';
                resultCard.classList.add('print-animation');
                redDivider.classList.remove('flashing-neon-divider'); 

                updateDisplay(`è¨ºæ–·å¤±æ•—ï¼Œè«‹é‡æ–°å˜—è©¦`, `ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æŸ¥çœ‹å‡ºå£å¡è¨Šæ¯ã€‚`);
            } finally {
                confirmButton.disabled = true;
            }
        }

        /**
         * è™•ç†è¿”å›æŒ‰éˆ•é»æ“Š
         */
        backButton.addEventListener('click', () => {
            clearTimeout(neonTimeout); 
            if (gameState === 'SUBSYMPTOM') {
                gameState = 'SYMPTOM';
                const symptoms = getFilteredSymptoms(selectedCategory); 
                renderOptions(symptoms, 'symptom');
                const genderDisplay = selectedGender === 'MALE' ? 'ç”·æ€§ (â™‚)' : 'å¥³æ€§ (â™€)';
                updateDisplay(`è«‹é¸æ“‡æ‚¨çš„å…·é«”ç—‡ç‹€:`, `[æ€§åˆ¥]: ${genderDisplay} | [é¡åˆ¥]: ${selectedCategory}`);
                selectedSubsymptoms = [];
                confirmButton.disabled = true;
            } else if (gameState === 'SYMPTOM') {
                gameState = 'CATEGORY';
                const categories = {};
                for (const key in data) { categories[key] = { icon: data[key].icon }; }
                renderOptions(categories, 'category');
                const genderDisplay = selectedGender === 'MALE' ? 'ç”·æ€§ (â™‚)' : 'å¥³æ€§ (â™€)';
                updateDisplay(`è«‹é¸æ“‡æ‚¨çš„ä¸»è¦ä¸é©é¡åˆ¥:`, `[æ€§åˆ¥]: ${genderDisplay}`);
                selectedCategory = null;
                selectedSymptom = null;
                confirmButton.disabled = true;
                backButton.classList.add('hidden'); 
            } else if (gameState === 'CATEGORY') {
                resetButton.click(); // é€€å›è‡³æ€§åˆ¥é¸æ“‡
            }
            redDivider.classList.remove('flashing-neon-divider'); 
        });

        /**
         * è™•ç†é‡æ–°é–‹å§‹æŒ‰éˆ•é»æ“Š
         */
        resetButton.addEventListener('click', () => {
            clearTimeout(neonTimeout); 
            // é‡ç½®æ‰€æœ‰ç‹€æ…‹
            gameState = 'GENDER';
            isServiceActive = false; // å¿…é ˆé‡æ–°æŠ•å¹£
            selectedGender = null;
            selectedCategory = null;
            selectedSymptom = null;
            selectedSubsymptoms = []; 
            
            renderOptions(GENDER_OPTIONS, 'gender');
            
            updateDisplay('è«‹æŠ•å¹£å•Ÿå‹•æœå‹™...');
            
            confirmButton.disabled = true;
            backButton.classList.add('hidden');
            resultCard.classList.add('hidden');
            resultCard.style.display = 'none';
            resultCard.classList.remove('print-animation');
            redDivider.classList.remove('flashing-neon-divider'); 
        });

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            resetButton.click(); 
        });

    </script>
</body>
</html>

