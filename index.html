<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³Œå°¿ç³»çµ±è‡ªå‹•è¨ºæ–·æ©Ÿ</title>
    <!-- è¼‰å…¥ Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Tone.js CDN for Sound Effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        /* ä½¿ç”¨ Inter å­—é«” */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1e3a; /* æ·±è—è‰²èƒŒæ™¯ */
        }
        .vending-machine {
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5), 
                        0 0 0 10px #223355; /* æ¨¡æ“¬æ©Ÿå™¨çš„é‚Šæ¡† */
            background-image: linear-gradient(145deg, #182846 0%, #101c30 100%); /* æ·±è‰²æ¼¸è®Š */
        }
        .vending-display {
            border: 5px solid #00c7e5; /* è—ç¶ è‰²é‚Šæ¡† */
            box-shadow: inset 0 0 10px #00c7e5, 0 0 15px #00c7e5; /* ç™¼å…‰æ•ˆæœ */
        }
        .item-button {
            transition: transform 0.1s, box-shadow 0.1s;
            background-image: linear-gradient(135deg, #2a3c5a 0%, #1f2d42 100%);
            /* ç¢ºä¿è‹±æ–‡å­—ä¸è¢«åˆ‡å‰²ï¼Œåªåœ¨å–®è©é–“éš”è™•æ›è¡Œ */
            word-break: normal; 
            overflow-wrap: break-word; 
            hyphens: manual; 
        }
        .item-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
        }
        .item-button:active {
            transform: translateY(0);
        }
        .selected {
            border: 3px solid #facc15; /* äº®é»ƒè‰²é‚Šæ¡†è¡¨ç¤ºé¸ä¸­ */
            box-shadow: 0 0 10px #facc15;
            background-image: linear-gradient(135deg, #facc15 0%, #eab308 100%);
            color: #1f2d42; /* æ·±è—è‰²æ–‡å­— */
            /* ç¢ºä¿è‹±æ–‡å­—ä¸è¢«åˆ‡å‰²ï¼Œåªåœ¨å–®è©é–“éš”è™•æ›è¡Œ */
            word-break: normal;
            overflow-wrap: break-word;
            hyphens: manual;
        }
        
        /* å¥åº·å»ºè­°å¡å‡ºå£æ§½å®¹å™¨æ¨£å¼ */
        .result-card-slot {
            background-color: #1f2d42;
            padding: 1rem; /* å…§éƒ¨é–“è· */
            border-radius: 0 0 0.75rem 0.75rem; /* åƒ…åº•éƒ¨åœ“è§’ */
            position: relative;
            min-height: 6rem; /* ä¿æŒæœ€å°é«˜åº¦ */
        }

        /* æ¨¡æ“¬ç´…ç²—ç·šçš„æ¨£å¼ (ç”¨ä¾†å–ä»£é‚Šæ¡†) */
        .red-divider {
            height: 8px; /* ç²—ç·šé«˜åº¦ */
            background-color: #ff0000; /* ç´…è‰² */
            width: 100%;
            /* çµ•å°å®šä½ï¼Œè²¼åˆåœ¨ `resultCardSlot` ä¸Šæ–¹ï¼Œä¸¦è®“å…¶é‚Šç·£ç™¼å…‰ */
            box-shadow: 0 0 5px #ff0000, 0 0 15px rgba(255, 0, 0, 0.8); 
            transition: box-shadow 0.3s;
        }
        
        /* æ¨¡æ“¬å°è¡¨æ©Ÿå‡ºç´™å‹•ç•«ï¼Œå¾é ‚éƒ¨é€æ¼¸å‡ºç¾ (æŒçºŒ 1.5s) */
        @keyframes printOut {
            0% {
                transform: translateY(-100%);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }
        .print-animation {
            animation: printOut 1.5s ease-out forwards;
        }

        /* ç´…è‰²éœ“è™¹é–ƒçˆå‹•ç•« */
        @keyframes neon-flash-red {
            0%, 100% {
                box-shadow: 0 0 5px #ff0000, 0 0 15px rgba(255, 0, 0, 0.8);
            }
            50% {
                box-shadow: 0 0 2px #ff0000, 0 0 8px rgba(255, 0, 0, 0.4);
            }
        }

        /* æ‡‰ç”¨æ–¼ç´…ç²—ç·šçš„é–ƒçˆé¡åˆ¥ */
        .flashing-neon-divider {
            animation: neon-flash-red 0.5s infinite alternate;
        }
    </style>
</head>
<body class="p-4 flex items-center justify-center min-h-screen">

    <div id="vendingMachine" class="vending-machine w-full max-w-lg mx-auto rounded-xl overflow-hidden p-4 sm:p-6 text-white border-8 border-gray-900">
        
        <!-- é ‚éƒ¨æ¨™é¡Œå’Œèªªæ˜ -->
        <h1 class="text-3xl sm:text-4xl font-extrabold text-center mb-6 tracking-wider text-[#00c7e5]">
            <span class="block">æ³Œå°¿ç³»çµ±è¨ºæ–·æ©Ÿ</span> 
            <!-- ç‰ˆæœ¬è³‡è¨Š -->
            <span class="text-base font-normal text-gray-400 block mt-1 text-center">URO Kiosk Unit-v1ï¼ˆ2025.9.28 e43814)</span>
        </h1>
        
        <!-- é¡¯ç¤ºè¢å¹• (å­—é«”å·²åŠ å¤§: text-xl sm:text-2xlï¼Œé«˜åº¦å·²å¢åŠ : h-28 sm:h-36) -->
        <div id="display" class="vending-display p-4 h-28 sm:h-36 mb-6 rounded-lg text-xl sm:text-2xl font-mono text-[#00c7e5] flex flex-col justify-center items-center text-center bg-[#101c30]">
            <!-- åˆå§‹æ–‡å­—å·²æ›´æ–° -->
            <p id="instructionText" class="animate-pulse">æ³Œé†«é—œå¿ƒæ‚¨ã€‚æ­¡è¿ä½¿ç”¨ï¼Œè«‹é¸æ“‡æ‚¨çš„æ€§åˆ¥...</p>
            <!-- æ¬¡è¦æç¤ºå­—é«”ä¹Ÿç¨å¾®åŠ å¤§åˆ° text-base -->
            <p id="selectionText" class="text-base text-gray-400 mt-1"></p>
        </div>

        <!-- ç‰©å“/é¸é …é¸æ“‡å€åŸŸ -->
        <div id="optionsGrid" class="grid grid-cols-2 gap-4 mb-6">
            <!-- é¸é …å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
        </div>

        <!-- çµæœ/æ§åˆ¶é¢æ¿ -->
        <!-- ç§»é™¤ mb-6ï¼Œè®“å…¶èˆ‡ç´…ç·šæ›´é è¿‘ -->
        <div class="p-4 rounded-lg bg-[#101c30] border border-gray-700">
            <h2 class="text-xl font-bold text-center mb-3 text-gray-300">æ§åˆ¶é¢æ¿</h2>
            <div class="flex justify-around space-x-4">
                <button id="confirmButton" class="w-full p-3 font-bold rounded-xl text-lg bg-yellow-500 hover:bg-yellow-600 text-gray-900 transition duration-150 disabled:opacity-50" disabled>
                    ç¢ºèªé¸æ“‡ (âœ“)
                </button>
                <button id="backButton" class="w-full p-3 font-bold rounded-xl text-lg bg-blue-600 hover:bg-blue-700 transition duration-150 hidden">
                    è¿”å›ä¸Šå±¤ (â†)
                </button>
                <button id="resetButton" class="w-full p-3 font-bold rounded-xl text-lg bg-red-600 hover:bg-red-700 transition duration-150">
                    é‡æ–°é–‹å§‹ (âŸ²)
                </button>
            </div>
        </div>

        <!-- è¨ºæ–·å¡å‡ºå£æ§½ï¼šæ ¹æ“šç”¨æˆ¶è¦æ±‚ï¼Œå°‡ä¸Šç·£é‚Šæ¡†æ›¿æ›ç‚ºç¨ç«‹çš„ç´…ç²—ç·š DIV -->
        <div class="mt-4">
            <!-- ç´…ç²—ç·šï¼šç”¨æ–¼åˆ†éš”æ§åˆ¶é¢æ¿å’Œå‡ºå£æ§½ï¼Œä¸¦é€²è¡Œéœ“è™¹é–ƒçˆ -->
            <div id="redDivider" class="red-divider"></div>

            <!-- å‡ºå£æ§½å®¹å™¨ï¼šç§»é™¤æ‰€æœ‰é‚Šæ¡†å’Œé ‚éƒ¨é‚Šç·£æ¨£å¼ï¼Œåƒ…ä¿ç•™èƒŒæ™¯å’Œåº•éƒ¨åœ“è§’ -->
            <!-- ç§»é™¤ mt-6ï¼Œæ”¹ç‚ºç”±ç´…ç·šé–“éš” -->
            <div id="resultCardSlot" class="result-card-slot">
                <p class="text-sm text-gray-500 mb-2">å¥åº·å»ºè­°å¡å‡ºå£ (è«‹åœ¨æ­¤é ˜å–):</p>
                <!-- ç¢ºä¿åˆå§‹ç‹€æ…‹æ˜¯ hidden -->
                <div id="resultCard" class="hidden bg-gray-100 p-4 rounded-lg text-gray-900 shadow-xl"> 
                    <h3 class="text-xl font-bold text-blue-600 mb-2">è¨ºæ–·å¡å·²ç™¼æ”¾</h3>
                    <p id="cardTitle" class="font-semibold text-lg"></p>
                    <!-- ç¢ºä¿ä½¿ç”¨ DIV å®¹å™¨ä»¥å®¹ç´è¤‡é›œçš„ HTML å…§å®¹ -->
                    <div id="cardContent" class="text-sm mt-2"></div> 
                    <p class="text-xs text-red-600 mt-3 font-bold">â€» ç·Šæ€¥å…è²¬è²æ˜ï¼šæœ¬å¡ä¸å…·é†«ç™‚è¨ºæ–·æ•ˆåŠ›ï¼Œè«‹å‹™å¿…è«®è©¢æ³Œå°¿ç§‘é†«å¸«ã€‚</p>
                </div>
            </div>
        </div>

    </div>

    <script>
        // è¨­å®šå…¨åŸŸè®Šæ•¸
        const display = document.getElementById('display');
        const instructionText = document.getElementById('instructionText');
        const selectionText = document.getElementById('selectionText');
        const optionsGrid = document.getElementById('optionsGrid');
        const confirmButton = document.getElementById('confirmButton');
        const backButton = document.getElementById('backButton');
        const resetButton = document.getElementById('resetButton');
        const redDivider = document.getElementById('redDivider'); // æ–°å¢ç´…ç·šå…ƒç´ 
        const resultCardSlot = document.getElementById('resultCardSlot'); 
        const resultCard = document.getElementById('resultCard');
        const cardTitle = document.getElementById('cardTitle');
        const cardContent = document.getElementById('cardContent');

        // æ¨¡æ“¬è¨ºæ–·æ©Ÿç‹€æ…‹
        let gameState = 'GENDER'; // æ–°å¢ GENDER éšæ®µ
        let selectedGender = null;
        let selectedCategory = null; // CATEGORY, SYMPTOM, SUBSYMPTOM, PROCESSING, RESULT
        let selectedSymptom = null;
        let selectedSubsymptoms = [];
        let neonTimeout = null; // ç”¨æ–¼å„²å­˜éœ“è™¹é–ƒçˆå®šæ™‚å™¨

        // Tone.js Synth åˆå§‹åŒ–
        let synth = null; 

        // éŸ³æ•ˆç”Ÿæˆé‚è¼¯ï¼šå…©è²è¼ƒçŸ­ã€è¼ƒè¼•çš„æç¤ºéŸ³
        function playPrintSound() {
            if (Tone.context.state !== 'running') {
                Tone.start().then(() => {
                    _generateSound();
                }).catch(err => {
                    console.error("Failed to start Tone.js AudioContext:", err);
                });
            } else {
                _generateSound();
            }
        }

        function _generateSound() {
            // ä½¿ç”¨ PolySynth æ¨¡æ“¬é›»å­å—¶è²
            if (!synth) {
                synth = new Tone.PolySynth(Tone.Synth, {
                    oscillator: { type: "square" }, // æ–¹æ³¢ç”¢ç”Ÿæ›´æ¸…æ™°çš„é›»å­éŸ³
                    envelope: {
                        attack: 0.01,
                        decay: 0.1,
                        sustain: 0.0,
                        release: 0.3
                    }
                }).toDestination();
            }
            
            const volume = 0.5; // æ¸›å¼±éŸ³é‡è‡³ 50%
            const now = Tone.now();
            const duration = "8n"; // å…«åˆ†éŸ³ç¬¦ï¼Œè¼ƒçŸ­

            // ç¬¬ä¸€è²ï¼šä½éŸ³ C4
            synth.triggerAttackRelease("C4", duration, now, volume); 
            // ç¬¬äºŒè²ï¼šé«˜éŸ³ D4ï¼Œé–“éš” 0.2 ç§’
            synth.triggerAttackRelease("D4", duration, now + 0.2, volume); 
        }

        // æ¨¡æ“¬æ•¸æ“šåº«ï¼šæ³Œå°¿ç³»çµ±é¡åˆ¥èˆ‡ç—‡ç‹€
        const data = {
            'æ’å°¿ç•°å¸¸ï¼ˆUrinary Dysfunctionï¼‰': {
                icon: 'ğŸ’§',
                symptoms: {
                    'é »å°¿/å¤œå°¿ï¼ˆFrequency/Nocturiaï¼‰': {
                        description: 'å¸¸è¦‹æ–¼æ”è­·è…ºè‚¥å¤§ã€è†€èƒ±éå‹•ç—‡ã€ç¥ç¶“æ€§è†€èƒ±ç­‰ã€‚å»ºè­°æ¸›å°‘åˆºæ¿€æ€§é£²æ–™åŠç¡å‰é£²æ°´ï¼Œä¸¦é€²è¡Œæ’å°¿è¨“ç·´ã€‚',
                        subsymptoms: {
                            'æ—¥é–“é »å°¿ï¼ˆDaytime Frequencyï¼‰': 'å¯èƒ½èˆ‡å’–å•¡å› æˆ–æ¶²é«”æ”å–éå¤šç›¸é—œã€‚å»ºè­°ç›£æ¸¬æ¯æ—¥é£²æ°´é‡ã€‚',
                            'å¤œé–“å¤šå°¿ï¼ˆNocturiaï¼‰': 'å¯èƒ½èˆ‡å¿ƒè‡Ÿæˆ–è…è‡Ÿå•é¡Œç›¸é—œã€‚è‹¥è¶…é2æ¬¡/å¤œï¼Œéœ€æª¢æŸ¥è¡€ç³–åŠå¿ƒåŠŸèƒ½ã€‚',
                            'ä¼´éš¨æ€¥å°¿ï¼ˆWith Urgencyï¼‰': 'æš—ç¤ºè†€èƒ±éå‹•ç—‡ã€‚è€ƒæ…®æŠ—è†½é¹¼è—¥ç‰©æ²»ç™‚ã€‚'
                        }
                    },
                    'æ’å°¿ç–¼ç—›ï¼ˆDysuriaï¼‰': {
                        description: 'æ’å°¿æ™‚ä¼´éš¨ç¼ç†±ã€åˆºç—›æˆ–ä¸é©æ„Ÿã€‚æœ€å¸¸è¦‹æ–¼æ³Œå°¿é“æ„ŸæŸ“ï¼ˆUTIï¼‰æˆ–è†€èƒ±ç‚ï¼Œä½†çµçŸ³æˆ–æ”è­·è…ºç‚äº¦å¯èƒ½å¼•èµ·ã€‚éœ€é€²è¡Œå°¿æ¶²å¸¸è¦æª¢æŸ¥ã€‚',
                        subsymptoms: {
                            'ç¼ç†±æ„Ÿï¼ˆBurning Sensationï¼‰': 'é«˜åº¦æç¤ºå°¿é“æˆ–è†€èƒ±åˆºæ¿€ï¼Œå¸¸è¦‹æ–¼è†€èƒ±ç‚ã€‚',
                            'åˆºç—›æ„Ÿï¼ˆStabbing Painï¼‰': 'å¯èƒ½èˆ‡çµçŸ³æˆ–å°¿é“ç‚ç—‡ç›¸é—œã€‚',
                            'æ’å°¿å¾Œç–¼ç—›ï¼ˆPain after Voidingï¼‰': 'å¤šèˆ‡è†€èƒ±ç—™æ”£ç›¸é—œï¼Œè¦‹æ–¼é–“è³ªæ€§è†€èƒ±ç‚ã€‚',
                            'å°¿é“å£ç–¼ç—›ï¼ˆMeatal Painï¼‰': 'æç¤ºå°¿é“ç‚æˆ–é¾œé ­ç‚ã€‚'
                        }
                    },
                    'å°¿æ€¥/æ€¥è¿«æ€§å°¿å¤±ç¦ï¼ˆUrgency/Urge Incontinenceï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è†€èƒ±éå‹•ç—‡ã€ç¥ç¶“æ€§è†€èƒ±ç­‰ã€‚å»ºè­°é€²è¡Œéª¨ç›†åº•è‚Œè¨“ç·´ï¼ˆå‡±æ ¼çˆ¾é‹å‹•ï¼‰ã€‚',
                        subsymptoms: {
                            'çªç„¶å¼·çƒˆå°¿æ„ï¼ˆSudden Urgeï¼‰': 'å¯èƒ½èˆ‡æ„ŸæŸ“æˆ–ç¥ç¶“å•é¡Œç›¸é—œã€‚éœ€å°¿åŸ¹é¤Šæª¢æŸ¥ã€‚',
                            'æ¼å°¿ç™¼ç”Ÿï¼ˆLeakageï¼‰': 'å€åˆ†æ€¥è¿«æ€§å¤±ç¦ã€‚è€ƒæ…®è—¥ç‰©æ²»ç™‚ã€‚',
                            'é »ç¹ç™¼ä½œï¼ˆFrequent Episodesï¼‰': 'è¨˜éŒ„æ—¥èªŒï¼Œå°‹æ±‚æ³Œå°¿ç§‘å”åŠ©ã€‚'
                        }
                    },
                    'æ’å°¿å›°é›£ï¼ˆVoiding Difficultyï¼‰': {
                        description: 'è¡¨ç¾ç‚ºè§£å°¿è²»åŠ›ã€å°¿æµè®Šç´°ã€é²ç·©ã€æ–·çºŒã€é¤˜å°¿æ„Ÿã€‚å¸¸è¦‹æ–¼æ”è­·è…ºè‚¥å¤§ã€å°¿é“ç‹¹çª„ã€‚éœ€æµé‡æª¢æŸ¥ã€‚',
                        subsymptoms: {
                            'èµ·å§‹å»¶é²ï¼ˆHesitancyï¼‰': 'å¸¸è¦‹æ–¼å‰åˆ—è…ºè‚¥å¤§ã€‚å»ºè­°alphaé˜»æ–·åŠ‘ã€‚',
                            'å°¿æµä¸­æ–·ï¼ˆIntermittencyï¼‰': 'å¯èƒ½å°¿é“ç‹¹çª„ã€‚éœ€å½±åƒå­¸æª¢æŸ¥ã€‚',
                            'é¤˜å°¿æ„Ÿï¼ˆPost-void Dribblingï¼‰': 'æš—ç¤ºè†€èƒ±é ¸å•é¡Œã€‚é€²è¡Œæ®˜å°¿é‡æ¸¬é‡ã€‚'
                        }
                    },
                }
            },
            'å°¿æ¶²ç•°å¸¸ï¼ˆUrine Abnormalitiesï¼‰': {
                icon: 'ğŸ©¸',
                symptoms: {
                    'è¡€å°¿ï¼ˆHematuriaï¼‰': {
                        description: 'åŒ…æ‹¬é¡¯å¾®è¡€å°¿ã€è‚‰çœ¼è¡€å°¿ã€‚éœ€è­¦è¦ºæ„ŸæŸ“ã€çµçŸ³ã€è…«ç˜¤ã€‚å°¤å…¶å¹´é•·è€…ï¼Œéœ€ç«‹å³æ’é™¤æƒ¡æ€§è…«ç˜¤ã€‚',
                        subsymptoms: {
                            'è‚‰çœ¼è¡€å°¿ï¼ˆGross Hematuriaï¼‰': 'ç„¡è«–æ˜¯å¦ç–¼ç—›ï¼Œéƒ½æ˜¯åš´é‡å¾µå…†ã€‚è«‹åœ¨24å°æ™‚å…§çœ‹æ³Œå°¿ç§‘ã€‚',
                            'é¡¯å¾®è¡€å°¿ï¼ˆMicroscopic Hematuriaï¼‰': 'é€šå¸¸å¥åº·æª¢æŸ¥ç™¼ç¾ã€‚è‹¥åˆä½µè›‹ç™½å°¿ï¼Œéœ€æª¢æŸ¥è…è‡Ÿç—…è®Šã€‚',
                            'é–“æ­‡æ€§ï¼ˆIntermittentï¼‰': 'æª¢æŸ¥å‡è¡€åŠŸèƒ½æˆ–å½±åƒå­¸ã€‚'
                        }
                    },
                    'è†¿å°¿/å°¿æ¶²æ··æ¿æˆ–ç•°å‘³ï¼ˆPyuria/Cloudy or Odorous Urineï¼‰': {
                        description: 'å¤šæ•¸èˆ‡æ„ŸæŸ“æˆ–è„«æ°´æœ‰é—œã€‚è‹¥ä¼´éš¨ç™¼ç‡’ï¼Œæ‡‰å„˜å¿«é€²è¡Œå°¿æ¶²åˆ†æåŠç´°èŒåŸ¹é¤Šã€‚',
                        subsymptoms: {
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'é«˜åº¦æ‡·ç–‘UTIã€‚ç«‹å³æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'è„«æ°´ç›¸é—œï¼ˆDehydration-relatedï¼‰': 'å¢åŠ é£²æ°´ï¼Œé¿å…é«˜è›‹ç™½é£²é£Ÿã€‚',
                            'ç•°å‘³å¼·çƒˆï¼ˆStrong Odorï¼‰': 'å¯èƒ½ç´°èŒæ„ŸæŸ“ã€‚å°¿åŸ¹é¤Šæª¢æŸ¥ã€‚'
                        }
                    },
                    'å°¿æ¶²å¸¶æ³¡ï¼ˆFoamy Urineï¼‰': {
                        description: 'æç¤ºè›‹ç™½å°¿ï¼Œå¯èƒ½ç³»çµ±æ€§ç–¾ç—…å¦‚è…è‡Ÿç—…ã€‚éœ€è¡€æ¶²åŠ24å°æ™‚å°¿æ¶²æª¢æŸ¥è©•ä¼°è…åŠŸèƒ½ã€‚',
                        subsymptoms: {
                            'æŒçºŒä¸æ•£ï¼ˆPersistentï¼‰': 'æš—ç¤ºå¤§é‡è›‹ç™½å°¿ã€‚æª¢æŸ¥ç³–å°¿ç—…æˆ–é«˜è¡€å£“ã€‚',
                            'åˆä½µæ°´è…«ï¼ˆWith Edemaï¼‰': 'è…ç—…ç—‡å€™ç¾¤ã€‚è…åŠŸèƒ½æª¢æŸ¥ã€‚',
                            'å®¶æ—å²ï¼ˆFamilialï¼‰': 'è€ƒæ…®éºå‚³æ€§è…ç—…ã€‚'
                        }
                    },
                }
            },
            'ç–¼ç—›ç›¸é—œï¼ˆPain-Relatedï¼‰': {
                icon: 'âš ï¸',
                symptoms: {
                    'è…°ç—›/è‚‹è„Šè§’ç—›ï¼ˆFlank Pain/Costovertebral Angle Tendernessï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è…ç›‚è…ç‚ã€è…çµçŸ³ã€‚æœ‰æ™‚ç‚ºæ€¥ç—‡ï¼Œéœ€å¿«é€Ÿåˆ¤æ–·ã€‚',
                        subsymptoms: {
                            'åŠ‡ç—›çªç™¼ï¼ˆSevere Sudden Painï¼‰': 'å¼·çƒˆæ‡·ç–‘è…çµç—›ã€‚ç«‹å³æ›æ€¥è¨ºã€‚',
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'æ’é™¤è…ç›‚è…ç‚ã€‚æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'åè¦†ç™¼ä½œï¼ˆRecurrentï¼‰': 'æª¢æŸ¥çµçŸ³ä»£è¬ç•°å¸¸ã€‚'
                        }
                    },
                    'ä¸‹è…¹ç—›/æœƒé™°ç—›ï¼ˆSuprapubic/Perineal Painï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è†€èƒ±ç‚ã€æ”è­·è…ºç‚ã€‚å»ºè­°è¨˜éŒ„ç–¼ç—›æ—¥èªŒï¼Œå°‹æ±‚ç–¼ç—›ç§‘/æ³Œå°¿ç§‘å”åŠ©ã€‚',
                        subsymptoms: {
                            'æ’å°¿æ™‚åŠ åŠ‡ï¼ˆWorsens with Urinationï¼‰': 'å¯èƒ½è†€èƒ±ç‚ã€‚å°¿åŸ¹é¤Šã€‚',
                            'æ…¢æ€§ç–¼ç—›ï¼ˆChronicï¼‰': 'ç”·æ€§è€ƒæ…®æ…¢æ€§å‰åˆ—è…ºç‚ï¼›å¥³æ€§æ’é™¤é–“è³ªæ€§è†€èƒ±ç‚ã€‚',
                            'å±€éƒ¨è…«è„¹ï¼ˆLocalized Swellingï¼‰': 'æª¢æŸ¥æ„ŸæŸ“æˆ–é˜»å¡ã€‚'
                        }
                    },
                    'çªä¸¸ç—›/é™°å›Šè…«è„¹ï¼ˆTesticular Pain/Scrotal Swellingï¼‰': {
                        description: 'å¸¸è¦‹æ–¼å‰¯çªç‚ã€çªä¸¸æ‰­è½‰ã€‚éœ€å¿«é€Ÿåˆ¤æ–·ï¼Œå¯èƒ½ç‚ºæ€¥ç—‡ã€‚',
                        subsymptoms: {
                            'çªç™¼åŠ‡ç—›ï¼ˆSudden Severe Painï¼‰': 'æ‡·ç–‘çªä¸¸æ‰­è½‰ã€‚ç«‹å³æ‰‹è¡“ã€‚',
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'å‰¯çªç‚ã€‚æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'è…«è„¹æ˜é¡¯ï¼ˆObvious Swellingï¼‰': 'è¶…éŸ³æ³¢æª¢æŸ¥æ’é™¤è…«ç˜¤ã€‚'
                        }
                    },
                    'å…¨èº«æ€§ç™¼ç‡’/å¯’é¡«ï¼ˆSystemic Fever/Chillsï¼‰': {
                        description: 'å…¨èº«æ€§ç™¼ç‡’ï¼ˆ>38Â°Cï¼‰æˆ–ç•å¯’ã€‚åœ¨æ³Œå°¿ç³»çµ±ä¸­ï¼Œé€™é«˜åº¦æš—ç¤ºå­˜åœ¨æ€¥æ€§æ„ŸæŸ“ï¼Œå¦‚è…ç›‚è…ç‚ã€æ€¥æ€§å‰åˆ—è…ºç‚æˆ–å‰¯çªç‚ã€‚å¿…é ˆç«‹å³å°±é†«ã€‚',
                        subsymptoms: {
                            'é«˜ç‡’æŒçºŒï¼ˆSustained High Feverï¼‰': 'ç«‹å³æ€¥è¨ºæª¢æŸ¥è¡€å¸¸è¦åŠå°¿æ¶²ï¼Œæ’é™¤æ•—è¡€ç—‡ã€‚',
                            'ä¼´éš¨ç•å¯’/ç™¼æŠ–ï¼ˆWith Chills/Rigorsï¼‰': 'æç¤ºèŒè¡€ç—‡é¢¨éšªé«˜ï¼Œå»ºè­°éœè„ˆæŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'ç„¡å…¶ä»–æ³Œå°¿ç—‡ç‹€ï¼ˆNo Other Urinary Symptomsï¼‰': 'éœ€æ’é™¤éæ³Œå°¿ç³»çµ±æ„ŸæŸ“ï¼Œå¦‚æµæ„Ÿæˆ–æ–°å† è‚ºç‚ã€‚'
                        }
                    },
                }
            },
            'ç”Ÿæ®–é“èˆ‡æ€§å¥åº·ï¼ˆGenital & Sexual Healthï¼‰': {
                icon: 'ğŸ¦ ', // æ–°çš„åœ–æ¨™ï¼Œå¼·èª¿æ„ŸæŸ“/ç”Ÿæ®–é“
                symptoms: {
                    // *** ç”·æ€§å°ˆå±¬ç—‡ç‹€ ( FEMALE æœƒè¢«éæ¿¾æ‰) ***
                    'å°¿é“åˆ†æ³Œç‰©ï¼ˆUrethral Dischargeï¼‰': {
                        description: 'å¸¸è¦‹æ–¼æ€§å‚³æ’­æ„ŸæŸ“ï¼ˆå¦‚æ·‹ç—…ã€è¡£åŸé«”ç­‰ï¼‰æˆ–å°¿é“ç‚ï¼Œéœ€é€²è¡Œå°¿é“æˆ–åˆ†æ³Œç‰©åŸ¹é¤Šæª¢æŸ¥ä»¥ç¢ºå®šç—…åŸé«”ã€‚è«‹å‘ŠçŸ¥é†«å¸«æ˜¯å¦æœ‰ä¸å®‰å…¨æ€§è¡Œç‚ºå²ã€‚',
                        isMaleOnly: true, // æ¨™è¨˜ç‚ºç”·æ€§å°ˆå±¬
                        subsymptoms: {
                            'é»ƒ/ç¶ è‰²æ¿ƒç¨ åˆ†æ³Œç‰©ï¼ˆThick Yellow/Green Dischargeï¼‰': 'é«˜åº¦æ‡·ç–‘æ·‹ç—…æ€§å°¿é“ç‚ï¼ˆGonococcal Urethritisï¼‰ã€‚éœ€ç«‹å³æŠ—ç”Ÿç´ æ²»ç™‚åŠè¿½è¹¤ã€‚',
                            'ç™½è‰²æ¸…æ¾ˆç¨€è–„åˆ†æ³Œç‰©ï¼ˆClear Thin White Dischargeï¼‰': 'å¸¸è¦‹æ–¼éæ·‹ç—…æ€§å°¿é“ç‚ï¼ˆNon-Gonococcal Urethritis, NGUï¼‰ï¼Œå¦‚è¡£åŸé«”æ„ŸæŸ“ã€‚',
                            'ä¼´éš¨ç™¼ç™¢æˆ–ç¼ç†±ï¼ˆWith Itching or Burningï¼‰': 'å¯èƒ½ç‚ºå–®ç´”çš°ç–¹æˆ–å…¶ä»–ç—…æ¯’æ„ŸæŸ“ã€‚',
                            'åƒ…æ¸…æ™¨åˆ†æ³Œç‰©ï¼ˆMorning Discharge Onlyï¼‰': 'å¸¸è¦‹æ–¼NGUã€‚å»ºè­°é€²è¡Œæ ¸é…¸æª¢æ¸¬

                    è¿”å›ä¸Šå±¤ (â†)
                </button>
                <button id="resetButton" class="w-full p-3 font-bold rounded-xl text-lg bg-red-600 hover:bg-red-700 transition duration-150">
                    é‡æ–°é–‹å§‹ (âŸ²)
                </button>
            </div>
        </div>

        <!-- è¨ºæ–·å¡å‡ºå£æ§½ (é‚Šæ¡†å·²åŠ ç²—åŠ ç´…ä»¥å¼·èª¿ä½ç½®) -->
        <div class="result-card-slot mt-6 p-4 rounded-b-xl border-t-4 border-gray-700 min-h-24">
            <p class="text-sm text-gray-500 mb-2">å¥åº·å»ºè­°å¡å‡ºå£ (è«‹åœ¨æ­¤é ˜å–):</p>
            <!-- ç¢ºä¿åˆå§‹ç‹€æ…‹æ˜¯ hidden -->
            <div id="resultCard" class="hidden bg-gray-100 p-4 rounded-lg text-gray-900 shadow-xl"> 
                <h3 class="text-xl font-bold text-blue-600 mb-2">è¨ºæ–·å¡å·²ç™¼æ”¾</h3>
                <p id="cardTitle" class="font-semibold text-lg"></p>
                <!-- ç¢ºä¿ä½¿ç”¨ DIV å®¹å™¨ä»¥å®¹ç´è¤‡é›œçš„ HTML å…§å®¹ -->
                <div id="cardContent" class="text-sm mt-2"></div> 
                <p class="text-xs text-red-600 mt-3 font-bold">â€» ç·Šæ€¥å…è²¬è²æ˜ï¼šæœ¬å¡ä¸å…·é†«ç™‚è¨ºæ–·æ•ˆåŠ›ï¼Œè«‹å‹™å¿…è«®è©¢æ³Œå°¿ç§‘é†«å¸«ã€‚</p>
            </div>
        </div>

    </div>

    <script>
        // è¨­å®šå…¨åŸŸè®Šæ•¸
        const display = document.getElementById('display');
        const instructionText = document.getElementById('instructionText');
        const selectionText = document.getElementById('selectionText');
        const optionsGrid = document.getElementById('optionsGrid');
        const confirmButton = document.getElementById('confirmButton');
        const backButton = document.getElementById('backButton');
        const resetButton = document.getElementById('resetButton');
        const resultCard = document.getElementById('resultCard');
        const cardTitle = document.getElementById('cardTitle');
        const cardContent = document.getElementById('cardContent');

        // æ¨¡æ“¬è¨ºæ–·æ©Ÿç‹€æ…‹
        let gameState = 'CATEGORY'; // CATEGORY, SYMPTOM, SUBSYMPTOM, PROCESSING, RESULT
        let selectedCategory = null;
        let selectedSymptom = null;
        let selectedSubsymptoms = [];

        // æ¨¡æ“¬æ•¸æ“šåº«ï¼šæ³Œå°¿ç³»çµ±é¡åˆ¥èˆ‡ç—‡ç‹€ (ä½¿ç”¨ä¸­æ–‡åè©ï¼ˆè‹±æ–‡ï¼‰æ ¼å¼ï¼Œä¸¦ä½¿ç”¨æ¨™æº–é†«å­¸è‹±æ–‡è¡“èª)
        const data = {
            'æ’å°¿ç•°å¸¸ï¼ˆUrinary Dysfunctionï¼‰': {
                icon: 'ğŸ’§',
                symptoms: {
                    'é »å°¿/å¤œå°¿ï¼ˆFrequency/Nocturiaï¼‰': {
                        description: 'å¸¸è¦‹æ–¼æ”è­·è…ºè‚¥å¤§ã€è†€èƒ±éå‹•ç—‡ã€ç¥ç¶“æ€§è†€èƒ±ç­‰ã€‚å»ºè­°æ¸›å°‘åˆºæ¿€æ€§é£²æ–™åŠç¡å‰é£²æ°´ï¼Œä¸¦é€²è¡Œæ’å°¿è¨“ç·´ã€‚',
                        subsymptoms: {
                            'æ—¥é–“é »å°¿ï¼ˆDaytime Frequencyï¼‰': 'å¯èƒ½èˆ‡å’–å•¡å› æˆ–æ¶²é«”æ”å–éå¤šç›¸é—œã€‚å»ºè­°ç›£æ¸¬æ¯æ—¥é£²æ°´é‡ã€‚',
                            'å¤œé–“å¤šå°¿ï¼ˆNocturiaï¼‰': 'å¯èƒ½èˆ‡å¿ƒè‡Ÿæˆ–è…è‡Ÿå•é¡Œç›¸é—œã€‚è‹¥è¶…é2æ¬¡/å¤œï¼Œéœ€æª¢æŸ¥è¡€ç³–åŠå¿ƒåŠŸèƒ½ã€‚',
                            'ä¼´éš¨æ€¥å°¿ï¼ˆWith Urgencyï¼‰': 'æš—ç¤ºè†€èƒ±éå‹•ç—‡ã€‚è€ƒæ…®æŠ—è†½é¹¼è—¥ç‰©æ²»ç™‚ã€‚'
                        }
                    },
                    // æ–°å¢çš„ç—‡ç‹€ï¼šæ’å°¿ç–¼ç—›ï¼ˆDysuriaï¼‰
                    'æ’å°¿ç–¼ç—›ï¼ˆDysuriaï¼‰': {
                        description: 'æ’å°¿æ™‚ä¼´éš¨ç¼ç†±ã€åˆºç—›æˆ–ä¸é©æ„Ÿã€‚æœ€å¸¸è¦‹æ–¼æ³Œå°¿é“æ„ŸæŸ“ï¼ˆUTIï¼‰æˆ–è†€èƒ±ç‚ï¼Œä½†çµçŸ³æˆ–æ”è­·è…ºç‚äº¦å¯èƒ½å¼•èµ·ã€‚éœ€é€²è¡Œå°¿æ¶²å¸¸è¦æª¢æŸ¥ã€‚',
                        subsymptoms: {
                            'ç¼ç†±æ„Ÿï¼ˆBurning Sensationï¼‰': 'é«˜åº¦æç¤ºå°¿é“æˆ–è†€èƒ±åˆºæ¿€ï¼Œå¸¸è¦‹æ–¼è†€èƒ±ç‚ã€‚',
                            'åˆºç—›æ„Ÿï¼ˆStabbing Painï¼‰': 'å¯èƒ½èˆ‡çµçŸ³æˆ–å°¿é“ç‚ç—‡ç›¸é—œã€‚',
                            'æ’å°¿å¾Œç–¼ç—›ï¼ˆPain after Voidingï¼‰': 'å¤šèˆ‡è†€èƒ±ç—™æ”£ç›¸é—œï¼Œè¦‹æ–¼é–“è³ªæ€§è†€èƒ±ç‚ã€‚',
                            'å°¿é“å£ç–¼ç—›ï¼ˆMeatal Painï¼‰': 'æç¤ºå°¿é“ç‚æˆ–é¾œé ­ç‚ã€‚'
                        }
                    },
                    'å°¿æ€¥/æ€¥è¿«æ€§å°¿å¤±ç¦ï¼ˆUrgency/Urge Incontinenceï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è†€èƒ±éå‹•ç—‡ã€ç¥ç¶“æ€§è†€èƒ±ç­‰ã€‚å»ºè­°é€²è¡Œéª¨ç›†åº•è‚Œè¨“ç·´ï¼ˆå‡±æ ¼çˆ¾é‹å‹•ï¼‰ã€‚',
                        subsymptoms: {
                            'çªç„¶å¼·çƒˆå°¿æ„ï¼ˆSudden Urgeï¼‰': 'å¯èƒ½èˆ‡æ„ŸæŸ“æˆ–ç¥ç¶“å•é¡Œç›¸é—œã€‚éœ€å°¿åŸ¹é¤Šæª¢æŸ¥ã€‚',
                            'æ¼å°¿ç™¼ç”Ÿï¼ˆLeakageï¼‰': 'å€åˆ†æ€¥è¿«æ€§å¤±ç¦ã€‚è€ƒæ…®è—¥ç‰©æ²»ç™‚ã€‚',
                            'é »ç¹ç™¼ä½œï¼ˆFrequent Episodesï¼‰': 'è¨˜éŒ„æ—¥èªŒï¼Œå°‹æ±‚æ³Œå°¿ç§‘å”åŠ©ã€‚'
                        }
                    },
                    'æ’å°¿å›°é›£ï¼ˆVoiding Difficultyï¼‰': {
                        description: 'è¡¨ç¾ç‚ºè§£å°¿è²»åŠ›ã€å°¿æµè®Šç´°ã€é²ç·©ã€æ–·çºŒã€é¤˜å°¿æ„Ÿã€‚å¸¸è¦‹æ–¼æ”è­·è…ºè‚¥å¤§ã€å°¿é“ç‹¹çª„ã€‚éœ€æµé‡æª¢æŸ¥ã€‚',
                        subsymptoms: {
                            'èµ·å§‹å»¶é²ï¼ˆHesitancyï¼‰': 'å¸¸è¦‹æ–¼å‰åˆ—è…ºè‚¥å¤§ã€‚å»ºè­°alphaé˜»æ–·åŠ‘ã€‚',
                            'å°¿æµä¸­æ–·ï¼ˆIntermittencyï¼‰': 'å¯èƒ½å°¿é“ç‹¹çª„ã€‚éœ€å½±åƒå­¸æª¢æŸ¥ã€‚',
                            'é¤˜å°¿æ„Ÿï¼ˆPost-void Dribblingï¼‰': 'æš—ç¤ºè†€èƒ±é ¸å•é¡Œã€‚é€²è¡Œæ®˜å°¿é‡æ¸¬é‡ã€‚'
                        }
                    },
                }
            },
            'å°¿æ¶²ç•°å¸¸ï¼ˆUrine Abnormalitiesï¼‰': {
                icon: 'ğŸ©¸',
                symptoms: {
                    'è¡€å°¿ï¼ˆHematuriaï¼‰': {
                        description: 'åŒ…æ‹¬é¡¯å¾®è¡€å°¿ã€è‚‰çœ¼è¡€å°¿ã€‚éœ€è­¦è¦ºæ„ŸæŸ“ã€çµçŸ³ã€è…«ç˜¤ã€‚å°¤å…¶å¹´é•·è€…ï¼Œéœ€ç«‹å³æ’é™¤æƒ¡æ€§è…«ç˜¤ã€‚',
                        subsymptoms: {
                            'è‚‰çœ¼è¡€å°¿ï¼ˆGross Hematuriaï¼‰': 'ç„¡è«–æ˜¯å¦ç–¼ç—›ï¼Œéƒ½æ˜¯åš´é‡å¾µå…†ã€‚è«‹åœ¨24å°æ™‚å…§çœ‹æ³Œå°¿ç§‘ã€‚',
                            'é¡¯å¾®è¡€å°¿ï¼ˆMicroscopic Hematuriaï¼‰': 'é€šå¸¸å¥åº·æª¢æŸ¥ç™¼ç¾ã€‚è‹¥åˆä½µè›‹ç™½å°¿ï¼Œéœ€æª¢æŸ¥è…è‡Ÿç—…è®Šã€‚',
                            'é–“æ­‡æ€§ï¼ˆIntermittentï¼‰': 'æª¢æŸ¥å‡è¡€åŠŸèƒ½æˆ–å½±åƒå­¸ã€‚'
                        }
                    },
                    'è†¿å°¿/å°¿æ¶²æ··æ¿æˆ–ç•°å‘³ï¼ˆPyuria/Cloudy or Odorous Urineï¼‰': {
                        description: 'å¤šæ•¸èˆ‡æ„ŸæŸ“æˆ–è„«æ°´æœ‰é—œã€‚è‹¥ä¼´éš¨ç™¼ç‡’ï¼Œæ‡‰å„˜å¿«é€²è¡Œå°¿æ¶²åˆ†æåŠç´°èŒåŸ¹é¤Šã€‚',
                        subsymptoms: {
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'é«˜åº¦æ‡·ç–‘UTIã€‚ç«‹å³æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'è„«æ°´ç›¸é—œï¼ˆDehydration-relatedï¼‰': 'å¢åŠ é£²æ°´ï¼Œé¿å…é«˜è›‹ç™½é£²é£Ÿã€‚',
                            'ç•°å‘³å¼·çƒˆï¼ˆStrong Odorï¼‰': 'å¯èƒ½ç´°èŒæ„ŸæŸ“ã€‚å°¿åŸ¹é¤Šæª¢æŸ¥ã€‚'
                        }
                    },
                    'å°¿æ¶²å¸¶æ³¡ï¼ˆFoamy Urineï¼‰': {
                        description: 'æç¤ºè›‹ç™½å°¿ï¼Œå¯èƒ½ç³»çµ±æ€§ç–¾ç—…å¦‚è…è‡Ÿç—…ã€‚éœ€è¡€æ¶²åŠ24å°æ™‚å°¿æ¶²æª¢æŸ¥è©•ä¼°è…åŠŸèƒ½ã€‚',
                        subsymptoms: {
                            'æŒçºŒä¸æ•£ï¼ˆPersistentï¼‰': 'æš—ç¤ºå¤§é‡è›‹ç™½å°¿ã€‚æª¢æŸ¥ç³–å°¿ç—…æˆ–é«˜è¡€å£“ã€‚',
                            'åˆä½µæ°´è…«ï¼ˆWith Edemaï¼‰': 'è…ç—…ç—‡å€™ç¾¤ã€‚è…åŠŸèƒ½æª¢æŸ¥ã€‚',
                            'å®¶æ—å²ï¼ˆFamilialï¼‰': 'è€ƒæ…®éºå‚³æ€§è…ç—…ã€‚'
                        }
                    },
                }
            },
            'ç–¼ç—›ç›¸é—œï¼ˆPain-Relatedï¼‰': {
                icon: 'âš ï¸',
                symptoms: {
                    'è…°ç—›/è‚‹è„Šè§’ç—›ï¼ˆFlank Pain/Costovertebral Angle Tendernessï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è…ç›‚è…ç‚ã€è…çµçŸ³ã€‚æœ‰æ™‚ç‚ºæ€¥ç—‡ï¼Œéœ€å¿«é€Ÿåˆ¤æ–·ã€‚',
                        subsymptoms: {
                            'åŠ‡ç—›çªç™¼ï¼ˆSevere Sudden Painï¼‰': 'å¼·çƒˆæ‡·ç–‘è…çµç—›ã€‚ç«‹å³æ›æ€¥è¨ºã€‚',
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'æ’é™¤è…ç›‚è…ç‚ã€‚æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'åè¦†ç™¼ä½œï¼ˆRecurrentï¼‰': 'æª¢æŸ¥çµçŸ³ä»£è¬ç•°å¸¸ã€‚'
                        }
                    },
                    'ä¸‹è…¹ç—›/æœƒé™°ç—›ï¼ˆSuprapubic/Perineal Painï¼‰': {
                        description: 'å¸¸è¦‹æ–¼è†€èƒ±ç‚ã€æ”è­·è…ºç‚ã€‚å»ºè­°è¨˜éŒ„ç–¼ç—›æ—¥èªŒï¼Œå°‹æ±‚ç–¼ç—›ç§‘/æ³Œå°¿ç§‘å”åŠ©ã€‚',
                        subsymptoms: {
                            'æ’å°¿æ™‚åŠ åŠ‡ï¼ˆWorsens with Urinationï¼‰': 'å¯èƒ½è†€èƒ±ç‚ã€‚å°¿åŸ¹é¤Šã€‚',
                            'æ…¢æ€§ç–¼ç—›ï¼ˆChronicï¼‰': 'ç”·æ€§è€ƒæ…®æ…¢æ€§å‰åˆ—è…ºç‚ï¼›å¥³æ€§æ’é™¤é–“è³ªæ€§è†€èƒ±ç‚ã€‚',
                            'å±€éƒ¨è…«è„¹ï¼ˆLocalized Swellingï¼‰': 'æª¢æŸ¥æ„ŸæŸ“æˆ–é˜»å¡ã€‚'
                        }
                    },
                    'çªä¸¸ç—›/é™°å›Šè…«è„¹ï¼ˆTesticular Pain/Scrotal Swellingï¼‰': {
                        description: 'å¸¸è¦‹æ–¼å‰¯çªç‚ã€çªä¸¸æ‰­è½‰ã€‚éœ€å¿«é€Ÿåˆ¤æ–·ï¼Œå¯èƒ½ç‚ºæ€¥ç—‡ã€‚',
                        subsymptoms: {
                            'çªç™¼åŠ‡ç—›ï¼ˆSudden Severe Painï¼‰': 'æ‡·ç–‘çªä¸¸æ‰­è½‰ã€‚ç«‹å³æ‰‹è¡“ã€‚',
                            'ä¼´éš¨ç™¼ç‡’ï¼ˆWith Feverï¼‰': 'å‰¯çªç‚ã€‚æŠ—ç”Ÿç´ æ²»ç™‚ã€‚',
                            'è…«è„¹æ˜é¡¯ï¼ˆObvious Swellingï¼‰': 'è¶…éŸ³æ³¢æª¢æŸ¥æ’é™¤è…«ç˜¤ã€‚'
                        }
                    },
                }
            },
            // é‡æ–°å®šç¾©æ­¤é¡åˆ¥ä»¥åŒ…å«å°¿é“åˆ†æ³Œç‰©å’Œæ€§ç—…ç¯©æŸ¥
            'ç”Ÿæ®–é“èˆ‡æ€§å¥åº·ï¼ˆGenital & Sexual Healthï¼‰': {
                icon: 'ğŸ¦ ', // æ–°çš„åœ–æ¨™ï¼Œå¼·èª¿æ„ŸæŸ“/ç”Ÿæ®–é“
                symptoms: {
                    // æ–°å¢çš„ç—‡ç‹€ï¼šå°¿é“åˆ†æ³Œç‰© (urethral discharge)
                    'å°¿é“åˆ†æ³Œç‰©ï¼ˆUrethral Dischargeï¼‰': {
                        description: 'å¸¸è¦‹æ–¼æ€§å‚³æ’­æ„ŸæŸ“ï¼ˆå¦‚æ·‹ç—…ã€è¡£åŸé«”ç­‰ï¼‰æˆ–å°¿é“ç‚ï¼Œéœ€é€²è¡Œå°¿é“æˆ–åˆ†æ³Œç‰©åŸ¹é¤Šæª¢æŸ¥ä»¥ç¢ºå®šç—…åŸé«”ã€‚è«‹å‘ŠçŸ¥é†«å¸«æ˜¯å¦æœ‰ä¸å®‰å…¨æ€§è¡Œç‚ºå²ã€‚',
                        subsymptoms: {
                            'é»ƒ/ç¶ è‰²æ¿ƒç¨ åˆ†æ³Œç‰©ï¼ˆThick Yellow/Green Dischargeï¼‰': 'é«˜åº¦æ‡·ç–‘æ·‹ç—…æ€§å°¿é“ç‚ï¼ˆGonococcal Urethritisï¼‰ã€‚éœ€ç«‹å³æŠ—ç”Ÿç´ æ²»ç™‚åŠè¿½è¹¤ã€‚',
                            'ç™½è‰²æ¸…æ¾ˆç¨€è–„åˆ†æ³Œç‰©ï¼ˆClear Thin White Dischargeï¼‰': 'å¸¸è¦‹æ–¼éæ·‹ç—…æ€§å°¿é“ç‚ï¼ˆNon-Gonococcal Urethritis, NGUï¼‰ï¼Œå¦‚è¡£åŸé«”æ„ŸæŸ“ã€‚',
                            'ä¼´éš¨ç™¼ç™¢æˆ–ç¼ç†±ï¼ˆWith Itching or Burningï¼‰': 'å¯èƒ½ç‚ºå–®ç´”çš°ç–¹æˆ–å…¶ä»–ç—…æ¯’æ„ŸæŸ“ã€‚',
                            'åƒ…æ¸…æ™¨åˆ†æ³Œç‰©ï¼ˆMorning Discharge Onlyï¼‰': 'å¸¸è¦‹æ–¼NGUã€‚å»ºè­°é€²è¡Œæ ¸é…¸æª¢æ¸¬ï¼ˆNAATï¼‰ã€‚',
                        }
                    },
                    'å‹ƒèµ·åŠŸèƒ½éšœç¤™/æ—©æ´©ï¼ˆErectile Dysfunction/Premature Ejaculationï¼‰': {
                        description: 'æ¶‰åŠæ³Œå°¿èˆ‡ç”Ÿæ®–åŠŸèƒ½ï¼Œå½±éŸ¿ç”Ÿæ´»å“è³ªã€‚å¯èƒ½èˆ‡æ”è­·è…ºå•é¡Œæˆ–è¡€ç®¡ç–¾ç—…ç›¸é—œã€‚',
                        subsymptoms: {
                            'æŒçºŒæ€§éšœç¤™ï¼ˆPersistent EDï¼‰': 'æª¢æŸ¥å¿ƒè¡€ç®¡é¢¨éšªã€‚è€ƒæ…®PDE5æŠ‘åˆ¶åŠ‘ã€‚',
                            'å¿ƒç†å› ç´ ï¼ˆPsychogenicï¼‰': 'å£“åŠ›ç›¸é—œã€‚å¿ƒç†è«®è©¢ã€‚',
                            'ä¼´éš¨å…¶ä»–ç—‡ç‹€ï¼ˆWith Other Symptomsï¼‰': 'å¦‚ç³–å°¿ç—…ã€‚ç¶œåˆè©•ä¼°ã€‚'
                        }
                    },
                    'è¡€ç²¾ç—‡ï¼ˆHemospermiaï¼‰': {
                        description: 'è¡€ç²¾ç—‡ã€‚éœ€æ’é™¤æ„ŸæŸ“ã€è…«ç˜¤æˆ–å¤–å‚·ã€‚å½±éŸ¿ç”Ÿè‚²ã€‚',
                        subsymptoms: {
                            'å–®æ¬¡ç™¼ç”Ÿï¼ˆSingle Episodeï¼‰': 'é€šå¸¸è‰¯æ€§ã€‚è§€å¯Ÿã€‚',
                            'åè¦†ï¼ˆRecurrentï¼‰': 'å‰åˆ—è…ºæª¢æŸ¥æˆ–è¶…éŸ³æ³¢ã€‚',
                            'ä¼´éš¨ç–¼ç—›ï¼ˆWith Painï¼‰': 'å¯èƒ½æ„ŸæŸ“ã€‚æŠ—ç”Ÿç´ ã€‚'
                        }
                    },
                    'ç”·æ€§ä¸å­•ç—‡ï¼ˆMale Infertilityï¼‰': {
                        description: 'å°‘ç²¾ç—‡ã€ç„¡ç²¾ç—‡ä¼´éš¨æ³Œå°¿ç³»ç•°å¸¸ã€‚å½±éŸ¿ç”Ÿè‚²ï¼Œéœ€ç²¾æ¶²åˆ†æã€‚',
                        subsymptoms: {
                            'å°‘ç²¾ç—‡ï¼ˆOligospermiaï¼‰': 'æª¢æŸ¥è·çˆ¾è’™æˆ–éºå‚³ã€‚',
                            'ç„¡ç²¾ç—‡ï¼ˆAzoospermiaï¼‰': 'æ’é™¤é˜»å¡æˆ–çªä¸¸å•é¡Œã€‚æ‰‹è¡“è©•ä¼°ã€‚',
                            'ä¼´éš¨æ³Œå°¿ç—‡ç‹€ï¼ˆWith Urological Symptomsï¼‰': 'å¦‚æ”è­·è…ºè‚¥å¤§ã€‚ç¶œåˆæ²»ç™‚ã€‚'
                        }
                    },
                }
            }
        };

        /**
         * æ›´æ–°é¡¯ç¤ºè¢å¹•ä¸Šçš„æ–‡å­—å’Œç‹€æ…‹
         * @param {string} instruction 
         * @param {string} selection 
         */
        function updateDisplay(instruction, selection = '') {
            instructionText.textContent = instruction;
            selectionText.textContent = selection;
        }

        /**
         * æ¸²æŸ“å¯é¸çš„æŒ‰éˆ•åˆ—è¡¨ï¼ˆé¡åˆ¥ã€ç—‡ç‹€æˆ–å­ç—‡ç‹€ï¼‰
         * @param {object} optionsMap - åŒ…å« key (åç¨±) å’Œ value (åœ–æ¨™/å…§å®¹) çš„ç‰©ä»¶
         * @param {string} type - 'category', 'symptom', or 'subsymptom'
         */
        function renderOptions(optionsMap, type) {
            optionsGrid.innerHTML = '';
            
            const keys = Object.keys(optionsMap);
            // èª¿æ•´ç¶²æ ¼ä½ˆå±€ï¼Œå¦‚æœé¸é …è¶…é 2 å€‹ï¼Œå‰‡ä½¿ç”¨ 2 æ¬„
            optionsGrid.className = `grid grid-cols-${keys.length > 2 ? '2' : '1'} sm:grid-cols-2 gap-4 mb-6`;
            
            keys.forEach(key => {
                const option = type === 'category' ? optionsMap[key] : (type === 'symptom' ? { icon: '' } : '');
                const button = document.createElement('button');
                button.textContent = type === 'category' ? `${option.icon} ${key}` : key;
                button.dataset.value = key;
                
                button.classList.add(
                    'item-button', 
                    'p-4', 
                    'rounded-xl', 
                    'text-base', 
                    'sm:text-lg', 
                    'font-bold', 
                    'text-gray-200',
                    'shadow-lg',
                    'border-2',
                    'border-gray-700',
                    'break-words' // Tailwind class ç¢ºä¿æ–‡å­—æ›è¡Œ
                );
                
                if (type === 'subsymptom' && selectedSubsymptoms.includes(key)) {
                    button.classList.add('selected', 'text-gray-900');
                    button.classList.remove('item-button', 'text-gray-200');
                } else if (type === 'symptom' && selectedSymptom === key) {
                    button.classList.add('selected', 'text-gray-900');
                    button.classList.remove('item-button', 'text-gray-200');
                }

                button.addEventListener('click', () => {
                    if (type === 'category') handleCategorySelect(key);
                    else if (type === 'symptom') handleSymptomSelect(key);
                    else if (type === 'subsymptom') handleSubsymptomToggle(key, button);
                });
                optionsGrid.appendChild(button);
            });
        }

        /**
         * è™•ç†é¡åˆ¥é¸æ“‡
         * @param {string} categoryName 
         */
        function handleCategorySelect(categoryName) {
            selectedCategory = categoryName;
            selectedSymptom = null; // ç¢ºä¿é‡ç½®
            selectedSubsymptoms = []; // ç¢ºä¿é‡ç½®
            gameState = 'SYMPTOM';
            const symptoms = data[categoryName].symptoms;
            renderOptions(symptoms, 'symptom');
            updateDisplay(`è«‹é¸æ“‡æ‚¨çš„å…·é«”ç—‡ç‹€:`, `[é¡åˆ¥]: ${categoryName}`);
            confirmButton.disabled = true;
            backButton.classList.remove('hidden');
            resultCard.classList.add('hidden');
            resultCard.style.display = 'none';
            resultCard.classList.remove('print-animation');
        }

        /**
         * è™•ç†ç—‡ç‹€é¸æ“‡ (å–®é¸)
         * @param {string} symptomName 
         */
        function handleSymptomSelect(symptomName) {
            selectedSymptom = symptomName;
            selectedSubsymptoms = []; // é‡ç½®å­ç—‡ç‹€
            gameState = 'SUBSYMPTOM';
            // ç”±æ–¼ç—‡ç‹€åˆ—è¡¨å¯èƒ½æ–°å¢äº†å…ƒç´ ï¼Œæ­¤è™•éœ€è¦ç¢ºä¿é¸ä¸­å¾Œå†æ¸²æŸ“å­ç—‡ç‹€
            const subsymptoms = data[selectedCategory].symptoms[symptomName].subsymptoms;
            renderOptions(subsymptoms, 'subsymptom');
            updateDisplay(`è«‹é¸æ“‡ç›¸é—œçš„å­ç—‡ç‹€ (å¯å¤šé¸):`, `[ç—‡ç‹€]: ${symptomName}`);
            // å­ç—‡ç‹€éšæ®µï¼Œä¸€é–‹å§‹æ²’æœ‰é¸æ“‡ï¼Œæ‰€ä»¥æŒ‰éˆ•ç¦ç”¨
            confirmButton.disabled = true; 
        }

        /**
         * è™•ç†å­ç—‡ç‹€çš„é¸æ“‡èˆ‡å–æ¶ˆ (å¤šé¸)
         * @param {string} subsymptomName 
         * @param {HTMLElement} button 
         */
        function handleSubsymptomToggle(subsymptomName, button) {
            const index = selectedSubsymptoms.indexOf(subsymptomName);

            if (index > -1) {
                selectedSubsymptoms.splice(index, 1);
                button.classList.remove('selected', 'text-gray-900');
                button.classList.add('item-button', 'text-gray-200');
            } else {
                selectedSubsymptoms.push(subsymptomName);
                button.classList.add('selected', 'text-gray-900');
                button.classList.remove('item-button', 'text-gray-200');
            }

            selectionText.textContent = `[å·²é¸å­é …ç›®]: ${selectedSubsymptoms.join('ã€') || 'ç„¡'}`;
            // åªè¦æœ‰é¸æ“‡ä¸€å€‹å­ç—‡ç‹€ï¼Œå°±å•Ÿç”¨ç¢ºèªæŒ‰éˆ•
            confirmButton.disabled = selectedSubsymptoms.length === 0;
        }

        /**
         * è™•ç†ç¢ºèªæŒ‰éˆ•é»æ“Š (é€²è¡Œæ¨¡æ“¬è¨ºæ–·)
         */
        confirmButton.addEventListener('click', () => {
            if (gameState !== 'SUBSYMPTOM' || selectedSubsymptoms.length === 0) return;

            gameState = 'PROCESSING';
            confirmButton.disabled = true;
            optionsGrid.innerHTML = '';
            
            updateDisplay('â–ˆâ–ˆâ–ˆâ–ˆ æƒæèˆ‡è™•ç†ä¸­... â–ˆâ–ˆâ–ˆâ–ˆ', 'ç³»çµ±æ­£åœ¨åŒ¹é…æœ€ç›¸é—œçš„å¥åº·è³‡è¨Šï¼Œè«‹ç¨å€™...');

            resultCard.classList.add('hidden');
            resultCard.style.display = 'none';
            resultCard.classList.remove('print-animation');

            setTimeout(() => {
                simulateDiagnosis();
            }, 3000);
        });

        /**
         * æ¨¡æ“¬è¨ºæ–·ä¸¦é¡¯ç¤ºçµæœå¡
         */
        function simulateDiagnosis() {
            try {
                gameState = 'RESULT';
                
                if (!selectedCategory || !selectedSymptom || !data[selectedCategory].symptoms[selectedSymptom] || selectedSubsymptoms.length === 0) {
                    throw new Error("è¨ºæ–·æ•¸æ“šä¸è¶³æˆ–ç„¡æ•ˆã€‚è«‹é‡æ–°é–‹å§‹ã€‚");
                }

                const symptomData = data[selectedCategory].symptoms[selectedSymptom];
                const subsymptomsMap = symptomData.subsymptoms;
                
                let combinedAdvice = `<ul>`;
                combinedAdvice += selectedSubsymptoms.map(sub => {
                    const advice = subsymptomsMap[sub] || 'æ­¤å­ç—‡ç‹€ç„¡ç‰¹å®šæ¨¡æ“¬å»ºè­°ã€‚';
                    return `<li class="mb-2"><span class="font-extrabold text-blue-900">${sub}</span>: ${advice}</li>`;
                }).join('');
                combinedAdvice += `</ul>`;
                
                const diagnosisTitle = `è¨ºæ–·ä»£ç¢¼: URO-${Math.floor(Math.random() * 900) + 100} - åˆæ­¥å°ˆæ¥­å»ºè­°`;
                let diagnosisContent = `<p class="font-medium mb-1">æ‚¨é¸æ“‡çš„ç—‡ç‹€é›†ä¸­åœ¨ï¼š<span class="text-red-700">${selectedCategory} - ${selectedSymptom}</span>ã€‚</p>`;
                
                diagnosisContent += `<span class="font-bold text-red-700 block mt-3">ã€é¦–è¦å»ºè­°èˆ‡é‘‘åˆ¥ã€‘</span><p class="font-medium mt-1">${symptomData.description}</p>`;
                diagnosisContent += `<span class="font-bold text-red-700 block mt-3">ã€ç´°ç¯€ç—‡ç‹€èˆ‡å»ºè­°ã€‘</span><div class="mt-1 text-sm space-y-1">${combinedAdvice}</div>`;
                
                cardTitle.textContent = diagnosisTitle;
                cardContent.innerHTML = diagnosisContent;
                
                resultCard.classList.remove('hidden');
                resultCard.style.display = 'block';
                resultCard.classList.add('print-animation');

                updateDisplay(`å»ºè­°å¡å·²å‡ºçˆ! è«‹å–èµ°`, `è«‹è©³é–±å»ºè­°ä¸¦å„˜é€Ÿå°±é†«ã€‚`);
                
                console.log("è¨ºæ–·å®Œæˆï¼Œçµæœå¡å·²å˜—è©¦é¡¯ç¤ºã€‚");
                backButton.classList.add('hidden');

            } catch (error) {
                console.error("æ¨¡æ“¬è¨ºæ–·å‡ºéŒ¯:", error);
                cardTitle.textContent = "ç³»çµ±éŒ¯èª¤ (Error)";
                cardContent.innerHTML = `<p class="text-red-500 font-bold">ç„¡æ³•å®Œæˆè¨ºæ–·ã€‚è«‹é»æ“Šã€Œé‡æ–°é–‹å§‹ã€æŒ‰éˆ•ã€‚</p><p class="mt-2 text-xs">æŠ€è¡“è¨Šæ¯: ${error.message}</p>`;
                resultCard.classList.remove('hidden');
                resultCard.style.display = 'block';
                resultCard.classList.add('print-animation');

                updateDisplay(`è¨ºæ–·å¤±æ•—ï¼Œè«‹é‡æ–°å˜—è©¦`, `ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æŸ¥çœ‹å‡ºå£å¡è¨Šæ¯ã€‚`);
            } finally {
                confirmButton.disabled = true;
            }
        }

        /**
         * è™•ç†è¿”å›æŒ‰éˆ•é»æ“Š
         */
        backButton.addEventListener('click', () => {
            if (gameState === 'SUBSYMPTOM') {
                // å¾å­ç—‡ç‹€è¿”å›ç—‡ç‹€é¸æ“‡
                gameState = 'SYMPTOM';
                const symptoms = data[selectedCategory].symptoms;
                renderOptions(symptoms, 'symptom');
                updateDisplay(`è«‹é¸æ“‡æ‚¨çš„å…·é«”ç—‡ç‹€:`, `[é¡åˆ¥]: ${selectedCategory}`);
                confirmButton.disabled = true;
                selectedSubsymptoms = [];
            } else if (gameState === 'SYMPTOM') {
                // å¾ç—‡ç‹€è¿”å›é¡åˆ¥é¸æ“‡ (ç­‰åŒæ–¼Reset)
                resetButton.click();
            }
        });

        /**
         * è™•ç†é‡æ–°é–‹å§‹æŒ‰éˆ•é»æ“Š
         */
        resetButton.addEventListener('click', () => {
            gameState = 'CATEGORY';
            selectedCategory = null;
            selectedSymptom = null;
            selectedSubsymptoms = [];
            
            const categories = {};
            for (const key in data) {
                categories[key] = { icon: data[key].icon };
            }
            renderOptions(categories, 'category');
            
            // åˆå§‹æ–‡å­—å·²æ›´æ–°
            updateDisplay('æ³Œé†«é—œå¿ƒæ‚¨ã€‚æ­¡è¿ä½¿ç”¨ï¼Œè«‹é¸æ“‡æ‚¨çš„ä¸»è¦ä¸é©é¡åˆ¥...');
            
            confirmButton.disabled = true;
            backButton.classList.add('hidden');
            resultCard.classList.add('hidden');
            resultCard.style.display = 'none';
            resultCard.classList.remove('print-animation');
        });

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            resetButton.click(); 
        });

    </script>
</body>
</html>

